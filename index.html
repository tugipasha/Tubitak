<!doctype html>
<html lang="tr" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Akƒ±llƒ± Ev Kiralama Sistemi</title>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.1/build/qrcode.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&amp;family=Poppins:wght@400;500;600;700&amp;display=swap" rel="stylesheet">
  <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            box-sizing: border-box;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
        }
        
        html, body {
            height: 100%;
            width: 100%;
        }
        
        .poppins {
            font-family: 'Poppins', sans-serif;
        }
        
        .app-container {
            width: 100%;
            height: 100%;
            overflow-y: auto;
        }
        
        /* Animasyonlar */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        @keyframes float {
            0%, 100% {
                transform: translateY(0px);
            }
            50% {
                transform: translateY(-10px);
            }
        }
        
        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.05);
            }
        }
        
        .fade-in {
            animation: fadeIn 0.6s ease-out forwards;
        }
        
        .float-animation {
            animation: float 3s ease-in-out infinite;
        }
        
        /* Card tasarƒ±mƒ± */
        .card {
            background: white;
            border-radius: 20px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.06);
            transition: all 0.3s ease;
        }
        
        .card:hover {
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.1);
            transform: translateY(-4px);
        }
        
        /* Button tasarƒ±mƒ± */
        .btn {
            border: none;
            border-radius: 12px;
            padding: 14px 28px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 15px;
            font-family: 'Inter', sans-serif;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #4F8EF7 0%, #5B9DFF 100%);
            color: white;
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #30C48D 0%, #3DD89E 100%);
            color: white;
        }
        
        .btn-outline {
            background: transparent;
            border: 2px solid #4F8EF7;
            color: #4F8EF7;
        }
        
        .btn-outline:hover {
            background: #4F8EF7;
            color: white;
        }
        
        /* Input tasarƒ±mƒ± */
        .input-field {
            width: 100%;
            padding: 14px 18px;
            border: 2px solid #E8ECF1;
            border-radius: 12px;
            font-size: 15px;
            transition: all 0.3s ease;
            font-family: 'Inter', sans-serif;
            background: white;
        }
        
        .input-field:focus {
            outline: none;
            border-color: #4F8EF7;
            box-shadow: 0 0 0 4px rgba(79, 142, 247, 0.1);
        }
        
        /* Toggle Switch */
        .toggle-switch {
            position: relative;
            width: 60px;
            height: 32px;
            background: #E8ECF1;
            border-radius: 32px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .toggle-switch.active {
            background: linear-gradient(135deg, #4F8EF7 0%, #5B9DFF 100%);
        }
        
        .toggle-switch::after {
            content: '';
            position: absolute;
            width: 26px;
            height: 26px;
            background: white;
            border-radius: 50%;
            top: 3px;
            left: 3px;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
        }
        
        .toggle-switch.active::after {
            left: 31px;
        }
        
        /* Oda kartlarƒ± */
        .room-card {
            background: white;
            border-radius: 16px;
            padding: 24px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            min-width: 120px;
        }
        
        .room-card.available {
            border-color: #30C48D;
            background: linear-gradient(135deg, #ffffff 0%, #f0fdf9 100%);
        }
        
        .room-card.available:hover {
            transform: translateY(-8px);
            box-shadow: 0 12px 30px rgba(48, 196, 141, 0.2);
        }
        
        .room-card.occupied {
            border-color: #FF4B5C;
            background: linear-gradient(135deg, #ffffff 0%, #fff5f5 100%);
            cursor: not-allowed;
            opacity: 0.7;
        }
        
        .room-icon {
            font-size: 48px;
            margin-bottom: 12px;
            display: block;
        }
        
        /* Toast Notification */
        .toast {
            position: fixed;
            top: 24px;
            right: 24px;
            background: white;
            padding: 16px 24px;
            border-radius: 12px;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
            z-index: 10000;
            animation: slideIn 0.3s ease;
            display: flex;
            align-items: center;
            gap: 12px;
            max-width: 400px;
        }
        
        .toast.success {
            border-left: 4px solid #30C48D;
        }
        
        .toast.error {
            border-left: 4px solid #FF4B5C;
        }
        
        .toast.info {
            border-left: 4px solid #4F8EF7;
        }
        
        /* Progress Steps */
        .progress-steps {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 40px;
            gap: 12px;
        }
        
        .step {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #E8ECF1;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .step.active {
            background: linear-gradient(135deg, #4F8EF7 0%, #5B9DFF 100%);
            color: white;
            transform: scale(1.1);
        }
        
        .step.completed {
            background: #30C48D;
            color: white;
        }
        
        .step-line {
            width: 60px;
            height: 3px;
            background: #E8ECF1;
            transition: all 0.3s ease;
        }
        
        .step-line.completed {
            background: #30C48D;
        }
        
        /* Sidebar */
        .sidebar {
            width: 280px;
            background: white;
            height: 100%;
            border-right: 1px solid #E8ECF1;
            padding: 32px 0;
            display: flex;
            flex-direction: column;
        }
        
        .sidebar-item {
            padding: 16px 32px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 12px;
            font-weight: 500;
            color: #6B7280;
        }
        
        .sidebar-item:hover {
            background: #F5F7FA;
            color: #4F8EF7;
        }
        
        .sidebar-item.active {
            background: linear-gradient(90deg, #EEF5FF 0%, transparent 100%);
            color: #4F8EF7;
            border-right: 3px solid #4F8EF7;
        }
        
        /* QR Code */
        .qr-container {
            background: white;
            padding: 24px;
            border-radius: 16px;
            display: inline-block;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
        }
        
        /* Background animation */
        .bg-pattern {
            position: absolute;
            width: 100%;
            height: 100%;
            opacity: 0.03;
            z-index: 0;
            pointer-events: none;
        }
        
        .bg-icon {
            position: absolute;
            font-size: 40px;
            opacity: 0.5;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .sidebar {
                display: none;
            }
            
            .room-card {
                min-width: 100px;
                padding: 16px;
            }
            
            .room-icon {
                font-size: 36px;
            }
        }
        
        /* Slider */
        .temperature-slider {
            width: 100%;
            height: 8px;
            border-radius: 8px;
            background: #E8ECF1;
            outline: none;
            -webkit-appearance: none;
        }
        
        .temperature-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: linear-gradient(135deg, #4F8EF7 0%, #5B9DFF 100%);
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(79, 142, 247, 0.3);
        }
        
        .temperature-slider::-moz-range-thumb {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: linear-gradient(135deg, #4F8EF7 0%, #5B9DFF 100%);
            cursor: pointer;
            border: none;
            box-shadow: 0 2px 8px rgba(79, 142, 247, 0.3);
        }
        
        /* Badge */
        .badge {
            display: inline-block;
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 600;
        }
        
        .badge-success {
            background: #D1FAE5;
            color: #065F46;
        }
        
        .badge-error {
            background: #FEE2E2;
            color: #991B1B;
        }
        
        .badge-info {
            background: #DBEAFE;
            color: #1E40AF;
        }
        
        .badge-warning {
            background: #FEF3C7;
            color: #92400E;
        }
    </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
 </head>
 <body class="h-full">
  <div id="app" class="app-container h-full w-full"></div>
  <script>
        const defaultConfig = {
            app_title: "Akƒ±llƒ± Ev Kiralama Sistemi",
            welcome_message: "Akƒ±llƒ± odalara anlƒ±k rezervasyon, kontrol ve giri≈ü sistemi",
            support_phone: "0850 XXX XX XX",
            support_email: "destek@akilliev.com",
            background_color: "#F5F7FA",
            surface_color: "#FFFFFF",
            text_color: "#1a1a1a",
            primary_action_color: "#4F8EF7",
            secondary_action_color: "#30C48D",
            font_family: "Inter",
            font_size: 16
        };

        let currentUser = null;
        let currentView = 'welcome';
        let selectedLocation = null;
        let selectedDateRange = null;
        let availableRooms = [];
        let registrationStep = 1;
        let registrationData = {};

        // Konaklama noktalarƒ±
        const locations = [
            { id: 1, name: "Road 96 Otoyolu - ƒ∞stanbul Konaklama", city: "ƒ∞stanbul", highway: "Road 96", roomCount: 10 },
            { id: 2, name: "Road 96 Otoyolu - Ankara Konaklama", city: "Ankara", highway: "Road 96", roomCount: 8 },
            { id: 3, name: "Road 96 Otoyolu - ƒ∞zmir Konaklama", city: "ƒ∞zmir", highway: "Road 96", roomCount: 12 },
            { id: 4, name: "E80 Otoyolu - Bursa Konaklama", city: "Bursa", highway: "E80", roomCount: 10 },
            { id: 5, name: "E90 Otoyolu - Antalya Konaklama", city: "Antalya", highway: "E90", roomCount: 15 }
        ];

        // Her konum i√ßin odalar
        const allRooms = {};
        locations.forEach(loc => {
            allRooms[loc.id] = [];
            for (let i = 1; i <= loc.roomCount; i++) {
                allRooms[loc.id].push({
                    id: `${loc.id}-${i}`,
                    locationId: loc.id,
                    number: i,
                    reservations: []
                });
            }
        });

        // LocalStorage helper functions
        function getUsers() {
            const users = localStorage.getItem('users');
            return users ? JSON.parse(users) : [];
        }

        function saveUser(user) {
            const users = getUsers();
            users.push(user);
            localStorage.setItem('users', JSON.stringify(users));
        }

        function updateUser(updatedUser) {
            const users = getUsers();
            const index = users.findIndex(u => u.id === updatedUser.id);
            if (index !== -1) {
                users[index] = updatedUser;
                localStorage.setItem('users', JSON.stringify(users));
            }
        }

        function getReservations() {
            const reservations = localStorage.getItem('reservations');
            return reservations ? JSON.parse(reservations) : [];
        }

        function saveReservation(reservation) {
            const reservations = getReservations();
            reservations.push(reservation);
            localStorage.setItem('reservations', JSON.stringify(reservations));
        }

        function updateReservation(updatedReservation) {
            const reservations = getReservations();
            const index = reservations.findIndex(r => r.id === updatedReservation.id);
            if (index !== -1) {
                reservations[index] = updatedReservation;
                localStorage.setItem('reservations', JSON.stringify(reservations));
            }
        }

        function checkRoomAvailability(locationId, checkIn, checkOut) {
            const reservations = getReservations();
            const requestStart = new Date(checkIn);
            const requestEnd = new Date(checkOut);
            
            const available = [];
            const rooms = allRooms[locationId];
            
            rooms.forEach(room => {
                const roomReservations = reservations.filter(r => 
                    r.room_id === room.id && 
                    r.status === 'active'
                );
                
                let isAvailable = true;
                roomReservations.forEach(res => {
                    const resStart = new Date(res.check_in);
                    const resEnd = new Date(res.check_out);
                    
                    if (!(requestEnd <= resStart || requestStart >= resEnd)) {
                        isAvailable = false;
                    }
                });
                
                if (isAvailable) {
                    available.push(room);
                }
            });
            
            return available;
        }

        function showToast(message, type = 'info') {
            const existingToast = document.querySelector('.toast');
            if (existingToast) {
                existingToast.remove();
            }
            
            const icons = {
                success: '‚úì',
                error: '‚úï',
                info: '‚Ñπ'
            };
            
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.innerHTML = `
                <div style="font-size: 20px; font-weight: bold;">${icons[type]}</div>
                <div style="font-weight: 500;">${message}</div>
            `;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.style.animation = 'slideIn 0.3s ease reverse';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        function validatePassword(password) {
            const hasLetter = /[a-zA-Z]/.test(password);
            const hasPunctuation = /[!@#$%^&*(),.?":{}|<>]/.test(password);
            return hasLetter && hasPunctuation;
        }

        function validateTCKimlik(tc) {
            return tc.length === 11 && /^\d+$/.test(tc);
        }

        function handleLogin(e) {
            e.preventDefault();
            const tcKimlik = document.getElementById('login-tc').value;
            const password = document.getElementById('login-password').value;
            
            if (!validateTCKimlik(tcKimlik)) {
                showToast('Ge√ßerli bir T.C. Kimlik No giriniz', 'error');
                return;
            }
            
            const users = getUsers();
            const user = users.find(u => u.tc_kimlik === tcKimlik && u.password === password);
            
            if (user) {
                currentUser = user;
                currentView = 'dashboard';
                renderCurrentView();
                showToast('Ho≈ü geldiniz, ' + user.ad + '!', 'success');
            } else {
                showToast('T.C. Kimlik No veya ≈üifre hatalƒ±', 'error');
            }
        }

        function continueWithoutLogin() {
            currentUser = null;
            currentView = 'location-select';
            renderCurrentView();
        }

        function logout() {
            currentUser = null;
            currentView = 'welcome';
            renderCurrentView();
            showToast('√áƒ±kƒ±≈ü yapƒ±ldƒ±', 'info');
        }

        function selectLocation(locationId) {
            selectedLocation = locations.find(l => l.id === locationId);
            currentView = 'date-select';
            renderCurrentView();
        }

        function searchAvailableRooms(e) {
            e.preventDefault();
            
            const checkIn = document.getElementById('check-in').value;
            const checkOut = document.getElementById('check-out').value;
            
            if (!checkIn || !checkOut) {
                showToast('L√ºtfen giri≈ü ve √ßƒ±kƒ±≈ü tarihlerini giriniz', 'error');
                return;
            }
            
            const checkInDate = new Date(checkIn);
            const checkOutDate = new Date(checkOut);
            
            if (checkOutDate <= checkInDate) {
                showToast('√áƒ±kƒ±≈ü tarihi giri≈ü tarihinden sonra olmalƒ±dƒ±r', 'error');
                return;
            }
            
            const hoursDiff = (checkOutDate - checkInDate) / (1000 * 60 * 60);
            if (hoursDiff > 24) {
                showToast('Maksimum kiralama s√ºresi 24 saattir (1 g√ºn)', 'error');
                return;
            }
            
            selectedDateRange = { checkIn, checkOut };
            availableRooms = checkRoomAvailability(selectedLocation.id, checkIn, checkOut);
            
            if (availableRooms.length === 0) {
                showToast('Se√ßilen tarih aralƒ±ƒüƒ±nda bo≈ü oda bulunmamaktadƒ±r', 'error');
                return;
            }
            
            currentView = 'available-rooms';
            renderCurrentView();
        }

        function selectRoom(roomId) {
            if (!currentUser) {
                showToast('Rezervasyon yapmak i√ßin l√ºtfen giri≈ü yapƒ±nƒ±z', 'error');
                currentView = 'login';
                renderCurrentView();
                return;
            }
            
            const room = availableRooms.find(r => r.id === roomId);
            window.selectedRoom = room;
            currentView = 'reservation-details';
            renderCurrentView();
        }

        function submitReservation(e) {
            e.preventDefault();
            
            const guestCount = document.getElementById('guest-count').value;
            
            const checkInDate = new Date(selectedDateRange.checkIn);
            const checkOutDate = new Date(selectedDateRange.checkOut);
            
            const hours = (checkOutDate - checkInDate) / (1000 * 60 * 60);
            const price = hours * 100;
            
            window.pendingReservation = {
                room: window.selectedRoom,
                guest_count: guestCount,
                check_in: selectedDateRange.checkIn,
                check_out: selectedDateRange.checkOut,
                hours: hours.toFixed(1),
                price: price,
                location: selectedLocation
            };
            
            currentView = 'payment';
            renderCurrentView();
        }

        function processPayment(e) {
            e.preventDefault();
            
            const cardNumber = document.getElementById('card-number').value;
            const cvv = document.getElementById('cvv').value;
            const expiry = document.getElementById('expiry').value;
            
            if (!cardNumber || !cvv || !expiry) {
                showToast('T√ºm kart bilgilerini giriniz', 'error');
                return;
            }
            
            const reservation = {
                id: Date.now().toString(),
                user_id: currentUser.id,
                room_id: window.pendingReservation.room.id,
                room_number: window.pendingReservation.room.number,
                location_id: window.pendingReservation.location.id,
                location_name: window.pendingReservation.location.name,
                guest_count: window.pendingReservation.guest_count,
                check_in: window.pendingReservation.check_in,
                check_out: window.pendingReservation.check_out,
                price: window.pendingReservation.price,
                status: 'active',
                ticket_number: 'TKT' + Date.now(),
                created_at: new Date().toISOString()
            };
            
            saveReservation(reservation);
            window.currentTicket = reservation;
            currentView = 'ticket';
            renderCurrentView();
            showToast('√ñdeme ba≈üarƒ±lƒ±! Rezervasyonunuz olu≈üturuldu', 'success');
        }

        function getUserReservations() {
            if (!currentUser) return { active: null, past: [], cancelled: [] };
            
            const now = new Date();
            const reservations = getReservations();
            const userReservations = reservations.filter(r => r.user_id === currentUser.id);
            
            const active = userReservations.find(r => 
                r.status === 'active' && new Date(r.check_out) > now
            );
            
            const past = userReservations.filter(r => 
                r.status === 'active' && new Date(r.check_out) <= now
            );
            
            const cancelled = userReservations.filter(r => r.status === 'cancelled');
            
            return { active, past, cancelled };
        }

        function cancelReservation(reservationId, reason) {
            const modal = document.createElement('div');
            modal.style.cssText = 'position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; z-index: 9999;';
            
            const primaryColor = window.elementSdk?.config?.primary_action_color || defaultConfig.primary_action_color;
            
            modal.innerHTML = `
                <div class="card" style="padding: 32px; max-width: 400px; margin: 20px; animation: fadeIn 0.3s ease;">
                    <h3 style="font-size: 22px; font-weight: 700; margin-bottom: 16px; color: #FF4B5C;">Rezervasyonu ƒ∞ptal Et</h3>
                    <p style="color: #6B7280; margin-bottom: 24px;">Bu i≈ülem geri alƒ±namaz. Devam etmek istediƒüinize emin misiniz?</p>
                    <div style="display: flex; gap: 12px;">
                        <button class="btn" style="flex: 1; background: #E8ECF1; color: #6B7280;">ƒ∞ptal</button>
                        <button class="btn" style="flex: 1; background: #FF4B5C; color: white;">Onayla</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            modal.querySelector('.btn:first-of-type').onclick = () => modal.remove();
            modal.querySelector('.btn:last-of-type').onclick = () => {
                const reservations = getReservations();
                const reservation = reservations.find(r => r.id === reservationId);
                if (reservation) {
                    reservation.status = 'cancelled';
                    reservation.cancellation_reason = reason;
                    reservation.cancelled_at = new Date().toISOString();
                    updateReservation(reservation);
                }
                modal.remove();
                showToast('Rezervasyon iptal edildi. Para iadeniz 3-5 i≈ü g√ºn√º i√ßinde hesabƒ±nƒ±za yansƒ±yacaktƒ±r.', 'success');
                currentView = 'dashboard';
                renderCurrentView();
            };
            
            modal.onclick = (e) => {
                if (e.target === modal) modal.remove();
            };
        }

        let lightState = false;
        let acState = false;
        let currentTemp = 22;
        let isBluetoothConnected = false;
        let bluetoothDevice = null;

        function toggleLight() {
            lightState = !lightState;
            const toggle = document.getElementById('light-toggle');
            if (toggle) {
                if (lightState) {
                    toggle.classList.add('active');
                } else {
                    toggle.classList.remove('active');
                }
            }
            showToast(lightState ? 'üí° I≈üƒ±k a√ßƒ±ldƒ±' : 'üí° I≈üƒ±k kapatƒ±ldƒ±', 'success');
        }

        function toggleAC() {
            acState = !acState;
            const toggle = document.getElementById('ac-toggle');
            const tempControl = document.getElementById('temp-control');
            if (toggle) {
                if (acState) {
                    toggle.classList.add('active');
                } else {
                    toggle.classList.remove('active');
                }
            }
            if (tempControl) {
                tempControl.style.display = acState ? 'block' : 'none';
            }
            showToast(acState ? '‚ùÑÔ∏è Klima a√ßƒ±ldƒ±' : '‚ùÑÔ∏è Klima kapatƒ±ldƒ±', 'success');
        }

        function updateTemp(value) {
            currentTemp = value;
            const display = document.getElementById('temp-display');
            if (display) {
                display.textContent = value + '¬∞C';
            }
        }

        function openDoor() {
            const btn = event.target;
            btn.disabled = true;
            btn.textContent = 'Kapƒ± A√ßƒ±lƒ±yor...';
            btn.style.background = '#6B7280';
            
            setTimeout(() => {
                showToast('üö™ Kapƒ± a√ßƒ±ldƒ±! L√ºtfen i√ßeri giriniz', 'success');
                btn.textContent = 'Kapƒ± A√ßƒ±ldƒ± ‚úì';
                btn.style.background = '#30C48D';
                setTimeout(() => {
                    btn.disabled = false;
                    btn.textContent = 'Kapƒ±yƒ± A√ß';
                    btn.style.background = '';
                }, 3000);
            }, 1500);
        }

        async function connectBluetooth() {
            try {
                if (!navigator.bluetooth) {
                    showToast('‚ö†Ô∏è Bu tarayƒ±cƒ± Bluetooth desteklemiyor', 'error');
                    return;
                }
                
                showToast('üì° Arduino aranƒ±yor...', 'info');
                
                const device = await navigator.bluetooth.requestDevice({
                    filters: [{ services: ['battery_service'] }],
                    optionalServices: ['battery_service']
                });
                
                bluetoothDevice = device;
                isBluetoothConnected = true;
                
                showToast('‚úì Arduino baƒülandƒ±! LED kontrol edebilirsiniz', 'success');
                renderCurrentView();
            } catch (error) {
                showToast('‚ùå Bluetooth baƒülantƒ±sƒ± kurulamadƒ±: ' + error.message, 'error');
            }
        }

        function disconnectBluetooth() {
            if (bluetoothDevice && bluetoothDevice.gatt.connected) {
                bluetoothDevice.gatt.disconnect();
            }
            isBluetoothConnected = false;
            bluetoothDevice = null;
            lightState = false;
            showToast('üì° Bluetooth baƒülantƒ±sƒ± kesildi', 'info');
            renderCurrentView();
        }

        // Registration Functions
        function nextStep() {
            if (registrationStep === 1) {
                const ad = document.getElementById('reg-ad').value;
                const soyad = document.getElementById('reg-soyad').value;
                const telefon = document.getElementById('reg-telefon').value;
                const email = document.getElementById('reg-email').value;
                const tcKimlik = document.getElementById('reg-tc').value;
                const cinsiyet = document.getElementById('reg-cinsiyet').value;
                
                if (!ad || !soyad || !telefon || !email || !tcKimlik || !cinsiyet) {
                    showToast('L√ºtfen t√ºm alanlarƒ± doldurunuz', 'error');
                    return;
                }
                
                if (!validateTCKimlik(tcKimlik)) {
                    showToast('Ge√ßerli bir T.C. Kimlik No giriniz', 'error');
                    return;
                }
                
                registrationData = { ad, soyad, telefon, email, tcKimlik, cinsiyet };
                registrationStep = 2;
                renderCurrentView();
            } else if (registrationStep === 2) {
                const username = document.getElementById('reg-username').value;
                const password = document.getElementById('reg-password').value;
                const passwordConfirm = document.getElementById('reg-password-confirm').value;
                
                if (!username || !password || !passwordConfirm) {
                    showToast('L√ºtfen t√ºm alanlarƒ± doldurunuz', 'error');
                    return;
                }
                
                if (!validatePassword(password)) {
                    showToast('≈ûifre en az 1 harf ve 1 noktalama i≈üareti i√ßermelidir', 'error');
                    return;
                }
                
                if (password !== passwordConfirm) {
                    showToast('≈ûifreler e≈üle≈ümiyor', 'error');
                    return;
                }
                
                const users = getUsers();
                if (users.find(u => u.username === username)) {
                    showToast('Bu kullanƒ±cƒ± adƒ± zaten kullanƒ±lƒ±yor', 'error');
                    return;
                }
                
                registrationData.username = username;
                registrationData.password = password;
                registrationStep = 3;
                renderCurrentView();
            } else if (registrationStep === 3) {
                const kvkkAccept = document.getElementById('reg-kvkk').checked;
                const termsAccept = document.getElementById('reg-terms').checked;
                
                if (!kvkkAccept || !termsAccept) {
                    showToast('Kullanƒ±m ≈üartlarƒ± ve KVKK onayƒ± zorunludur', 'error');
                    return;
                }
                
                const newUser = {
                    id: Date.now().toString(),
                    tc_kimlik: registrationData.tcKimlik,
                    username: registrationData.username,
                    password: registrationData.password,
                    ad: registrationData.ad,
                    soyad: registrationData.soyad,
                    telefon: registrationData.telefon,
                    email: registrationData.email,
                    cinsiyet: registrationData.cinsiyet,
                    created_at: new Date().toISOString()
                };
                
                saveUser(newUser);
                registrationStep = 4;
                renderCurrentView();
            }
        }

        function prevStep() {
            registrationStep = Math.max(1, registrationStep - 1);
            renderCurrentView();
        }

        function goToLogin() {
            currentView = 'login';
            registrationStep = 1;
            registrationData = {};
            renderCurrentView();
        }

        function goToRegister() {
            currentView = 'register';
            registrationStep = 1;
            renderCurrentView();
        }

        function goToWelcome() {
            currentView = 'welcome';
            renderCurrentView();
        }

        function goToDashboard() {
            currentView = 'dashboard';
            renderCurrentView();
        }

        // Render Functions
        function renderWelcome() {
            const customFont = window.elementSdk?.config?.font_family || defaultConfig.font_family;
            const baseSize = window.elementSdk?.config?.font_size || defaultConfig.font_size;
            const bgColor = window.elementSdk?.config?.background_color || defaultConfig.background_color;
            const primaryColor = window.elementSdk?.config?.primary_action_color || defaultConfig.primary_action_color;
            const secondaryColor = window.elementSdk?.config?.secondary_action_color || defaultConfig.secondary_action_color;
            const appTitle = window.elementSdk?.config?.app_title || defaultConfig.app_title;
            const welcomeMsg = window.elementSdk?.config?.welcome_message || defaultConfig.welcome_message;
            
            return `
                <div style="background: linear-gradient(135deg, ${bgColor} 0%, #E8F0FE 100%); font-family: ${customFont}, sans-serif; font-size: ${baseSize}px; min-height: 100%; display: flex; align-items: center; justify-content: center; padding: 24px; position: relative; overflow: hidden;">
                    <div class="bg-pattern">
                        <div class="bg-icon float-animation" style="top: 10%; left: 10%; animation-delay: 0s;">ÔøΩÔøΩÔøΩÔøΩ</div>
                        <div class="bg-icon float-animation" style="top: 20%; right: 15%; animation-delay: 0.5s;">üîë</div>
                        <div class="bg-icon float-animation" style="bottom: 15%; left: 20%; animation-delay: 1s;">üí°</div>
                        <div class="bg-icon float-animation" style="bottom: 25%; right: 10%; animation-delay: 1.5s;">‚ùÑÔ∏è</div>
                    </div>
                    
                    <div class="fade-in" style="max-width: 600px; width: 100%; text-align: center; position: relative; z-index: 1;">
                        <div style="font-size: ${baseSize * 4}px; margin-bottom: 24px;">üè°</div>
                        <h1 class="poppins" style="font-size: ${baseSize * 2.5}px; font-weight: 700; margin-bottom: 16px; color: #1a1a1a; line-height: 1.2;">
                            ${appTitle}
                        </h1>
                        <p style="font-size: ${baseSize * 1.1}px; color: #6B7280; margin-bottom: 48px; line-height: 1.6;">
                            ${welcomeMsg}
                        </p>
                        
                        <div style="display: flex; flex-direction: column; gap: 16px; max-width: 400px; margin: 0 auto;">
                            <button onclick="goToLogin()" class="btn btn-primary" style="width: 100%; font-size: ${baseSize * 1.1}px; padding: 18px;">
                                Giri≈ü Yap
                            </button>
                            <button onclick="goToRegister()" class="btn btn-outline" style="width: 100%; font-size: ${baseSize * 1.1}px; padding: 18px;">
                                √úye Ol
                            </button>
                        </div>
                        
                        <div style="margin-top: 32px; display: flex; flex-direction: column; gap: 12px;">
                            <button onclick="continueWithoutLogin()" style="background: none; border: none; color: ${primaryColor}; cursor: pointer; font-weight: 500; text-decoration: none; font-size: ${baseSize}px; font-family: ${customFont};">
                                √úye olmadan devam et ‚Üí
                            </button>
                            <button onclick="showToast('≈ûifre sƒ±fƒ±rlama baƒülantƒ±sƒ± e-posta adresinize g√∂nderildi', 'info')" style="background: none; border: none; color: #6B7280; cursor: pointer; font-size: ${baseSize * 0.9}px; text-decoration: none; font-family: ${customFont};">
                                ≈ûifremi unuttum
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderLogin() {
            const customFont = window.elementSdk?.config?.font_family || defaultConfig.font_family;
            const baseSize = window.elementSdk?.config?.font_size || defaultConfig.font_size;
            const bgColor = window.elementSdk?.config?.background_color || defaultConfig.background_color;
            const primaryColor = window.elementSdk?.config?.primary_action_color || defaultConfig.primary_action_color;
            
            return `
                <div style="background: ${bgColor}; font-family: ${customFont}, sans-serif; font-size: ${baseSize}px; min-height: 100%; display: flex; align-items: center; justify-content: center; padding: 24px;">
                    <div class="card fade-in" style="padding: 48px; max-width: 480px; width: 100%;">
                        <div style="text-align: center; margin-bottom: 40px;">
                            <h1 class="poppins" style="font-size: ${baseSize * 2}px; font-weight: 700; margin-bottom: 8px;">Giri≈ü Yap</h1>
                            <p style="color: #6B7280; font-size: ${baseSize * 0.95}px;">Hesabƒ±nƒ±za giri≈ü yapƒ±n</p>
                        </div>
                        
                        <form onsubmit="handleLogin(event)" style="display: flex; flex-direction: column; gap: 24px;">
                            <div>
                                <label for="login-tc" style="display: block; margin-bottom: 8px; font-weight: 600; font-size: ${baseSize * 0.9}px; color: #374151;">T.C. Kimlik No</label>
                                <input type="text" id="login-tc" maxlength="11" placeholder="11 haneli T.C. kimlik numaranƒ±z" class="input-field" required>
                            </div>
                            
                            <div>
                                <label for="login-password" style="display: block; margin-bottom: 8px; font-weight: 600; font-size: ${baseSize * 0.9}px; color: #374151;">≈ûifre</label>
                                <input type="password" id="login-password" placeholder="≈ûifrenizi giriniz" class="input-field" required>
                            </div>
                            
                            <button type="submit" class="btn btn-primary" style="width: 100%; padding: 16px; font-size: ${baseSize * 1.05}px;">
                                Giri≈ü Yap
                            </button>
                        </form>
                        
                        <div style="margin-top: 32px; text-align: center; display: flex; flex-direction: column; gap: 12px;">
                            <button onclick="goToRegister()" style="background: none; border: none; color: ${primaryColor}; cursor: pointer; font-weight: 500; text-decoration: none; font-size: ${baseSize}px; font-family: ${customFont};">
                                Hesabƒ±nƒ±z yok mu? √úye olun ‚Üí
                            </button>
                            <button onclick="goToWelcome()" style="background: none; border: none; color: #6B7280; cursor: pointer; font-size: ${baseSize * 0.9}px; text-decoration: none; font-family: ${customFont};">
                                ‚Üê Ana sayfaya d√∂n
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderRegister() {
            const customFont = window.elementSdk?.config?.font_family || defaultConfig.font_family;
            const baseSize = window.elementSdk?.config?.font_size || defaultConfig.font_size;
            const bgColor = window.elementSdk?.config?.background_color || defaultConfig.background_color;
            const primaryColor = window.elementSdk?.config?.primary_action_color || defaultConfig.primary_action_color;
            
            let stepContent = '';
            
            if (registrationStep === 1) {
                stepContent = `
                    <div style="display: flex; flex-direction: column; gap: 20px;">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                            <div>
                                <label for="reg-ad" style="display: block; margin-bottom: 8px; font-weight: 600; font-size: ${baseSize * 0.9}px; color: #374151;">Ad</label>
                                <input type="text" id="reg-ad" value="${registrationData.ad || ''}" placeholder="Adƒ±nƒ±z" class="input-field" required>
                            </div>
                            <div>
                                <label for="reg-soyad" style="display: block; margin-bottom: 8px; font-weight: 600; font-size: ${baseSize * 0.9}px; color: #374151;">Soyad</label>
                                <input type="text" id="reg-soyad" value="${registrationData.soyad || ''}" placeholder="Soyadƒ±nƒ±z" class="input-field" required>
                            </div>
                        </div>
                        
                        <div>
                            <label for="reg-telefon" style="display: block; margin-bottom: 8px; font-weight: 600; font-size: ${baseSize * 0.9}px; color: #374151;">Telefon Numarasƒ±</label>
                            <input type="tel" id="reg-telefon" value="${registrationData.telefon || ''}" placeholder="5XX XXX XX XX" class="input-field" required>
                        </div>
                        
                        <div>
                            <label for="reg-email" style="display: block; margin-bottom: 8px; font-weight: 600; font-size: ${baseSize * 0.9}px; color: #374151;">E-mail</label>
                            <input type="email" id="reg-email" value="${registrationData.email || ''}" placeholder="ornek@email.com" class="input-field" required>
                        </div>
                        
                        <div>
                            <label for="reg-tc" style="display: block; margin-bottom: 8px; font-weight: 600; font-size: ${baseSize * 0.9}px; color: #374151;">T.C. Kimlik No</label>
                            <input type="text" id="reg-tc" value="${registrationData.tcKimlik || ''}" maxlength="11" placeholder="11 haneli T.C. kimlik numaranƒ±z" class="input-field" required>
                        </div>
                        
                        <div>
                            <label for="reg-cinsiyet" style="display: block; margin-bottom: 8px; font-weight: 600; font-size: ${baseSize * 0.9}px; color: #374151;">Cinsiyet</label>
                            <select id="reg-cinsiyet" class="input-field" required>
                                <option value="">Se√ßiniz</option>
                                <option value="Kadƒ±n" ${registrationData.cinsiyet === 'Kadƒ±n' ? 'selected' : ''}>Kadƒ±n</option>
                                <option value="Erkek" ${registrationData.cinsiyet === 'Erkek' ? 'selected' : ''}>Erkek</option>
                                <option value="Belirtmek istemiyorum" ${registrationData.cinsiyet === 'Belirtmek istemiyorum' ? 'selected' : ''}>Belirtmek istemiyorum</option>
                            </select>
                        </div>
                    </div>
                `;
            } else if (registrationStep === 2) {
                const suggestedUsername = registrationData.ad && registrationData.soyad 
                    ? (registrationData.ad.toLowerCase() + '_' + registrationData.soyad.toLowerCase()) 
                    : '';
                
                stepContent = `
                    <div style="display: flex; flex-direction: column; gap: 20px;">
                        <div>
                            <label for="reg-username" style="display: block; margin-bottom: 8px; font-weight: 600; font-size: ${baseSize * 0.9}px; color: #374151;">Kullanƒ±cƒ± Adƒ±</label>
                            <input type="text" id="reg-username" value="${registrationData.username || suggestedUsername}" placeholder="Kullanƒ±cƒ± adƒ±nƒ±z" class="input-field" required>
                            <p style="font-size: ${baseSize * 0.85}px; color: #6B7280; margin-top: 6px;">√ñnerilen: ${suggestedUsername}</p>
                        </div>
                        
                        <div>
                            <label for="reg-password" style="display: block; margin-bottom: 8px; font-weight: 600; font-size: ${baseSize * 0.9}px; color: #374151;">≈ûifre</label>
                            <input type="password" id="reg-password" placeholder="G√ºÔøΩÔøΩl√º bir ≈üifre olu≈üturun" class="input-field" required>
                            <p style="font-size: ${baseSize * 0.85}px; color: #6B7280; margin-top: 6px;">En az 1 harf ve 1 noktalama i≈üareti i√ßermelidir</p>
                        </div>
                        
                        <div>
                            <label for="reg-password-confirm" style="display: block; margin-bottom: 8px; font-weight: 600; font-size: ${baseSize * 0.9}px; color: #374151;">≈ûifre Tekrar</label>
                            <input type="password" id="reg-password-confirm" placeholder="≈ûifrenizi tekrar giriniz" class="input-field" required>
                        </div>
                    </div>
                `;
            } else if (registrationStep === 3) {
                stepContent = `
                    <div style="display: flex; flex-direction: column; gap: 24px;">
                        <div class="card" style="padding: 24px; background: #F9FAFB; border: 2px solid #E8ECF1;">
                            <label style="display: flex; align-items: start; cursor: pointer; gap: 12px;">
                                <input type="checkbox" id="reg-terms" style="margin-top: 4px; width: 20px; height: 20px; cursor: pointer;" required>
                                <span style="font-size: ${baseSize * 0.95}px; line-height: 1.6;">
                                    <strong>Kullanƒ±m ≈ûartlarƒ±'nƒ±</strong> okudum ve kabul ediyorum. Hizmet kullanƒ±m koÔøΩÔøΩullarƒ±nƒ± anladƒ±ƒüƒ±mƒ± ve bunlara uyacaƒüƒ±mƒ± beyan ederim.
                                </span>
                            </label>
                        </div>
                        
                        <div class="card" style="padding: 24px; background: #F9FAFB; border: 2px solid #E8ECF1;">
                            <label style="display: flex; align-items: start; cursor: pointer; gap: 12px;">
                                <input type="checkbox" id="reg-kvkk" style="margin-top: 4px; width: 20px; height: 20px; cursor: pointer;" required>
                                <span style="font-size: ${baseSize * 0.95}px; line-height: 1.6;">
                                    <strong>KVKK Aydƒ±nlatma Metni ve Gizlilik S√∂zle≈ümesi'ni</strong> okudum ve ki≈üisel verilerimin i≈ülenmesini kabul ediyorum.
                                </span>
                            </label>
                        </div>
                        
                        <div style="background: #EEF5FF; padding: 20px; border-radius: 12px; border-left: 4px solid ${primaryColor};">
                            <p style="font-size: ${baseSize * 0.9}px; color: #1E40AF; line-height: 1.6;">
                                ‚ÑπÔ∏è Verileriniz g√ºvenli bir ≈üekilde saklanƒ±r ve √º√ß√ºnc√º ≈üahƒ±slarla payla≈üƒ±lmaz.
                            </p>
                        </div>
                    </div>
                `;
            } else if (registrationStep === 4) {
                stepContent = `
                    <div style="text-align: center; padding: 32px 0;">
                        <div style="font-size: ${baseSize * 4}px; margin-bottom: 24px;">üéâ</div>
                        <h2 style="font-size: ${baseSize * 1.8}px; font-weight: 700; margin-bottom: 16px; color: #30C48D;">√úyelik Ba≈üarƒ±lƒ±!</h2>
                        <p style="font-size: ${baseSize * 1.05}px; color: #6B7280; margin-bottom: 32px; line-height: 1.6;">
                            Ho≈ü geldiniz <strong>${registrationData.ad} ${registrationData.soyad}</strong>!<br>
                            Hesabƒ±nƒ±z ba≈üarƒ±yla olu≈üturuldu.
                        </p>
                        <button onclick="goToLogin()" class="btn btn-primary" style="padding: 16px 40px; font-size: ${baseSize * 1.05}px;">
                            Giri≈ü Yap
                        </button>
                    </div>
                `;
            }
            
            return `
                <div style="background: ${bgColor}; font-family: ${customFont}, sans-serif; font-size: ${baseSize}px; min-height: 100%; padding: 24px; overflow-y: auto;">
                    <div class="card fade-in" style="padding: 48px; max-width: 600px; margin: 0 auto;">
                        <div style="text-align: center; margin-bottom: 40px;">
                            <h1 class="poppins" style="font-size: ${baseSize * 2}px; font-weight: 700; margin-bottom: 8px;">√úye Ol</h1>
                            <p style="color: #6B7280; font-size: ${baseSize * 0.95}px;">Yeni hesap olu≈ütur</p>
                        </div>
                        
                        ${registrationStep < 4 ? `
                        <div class="progress-steps">
                            <div class="step ${registrationStep >= 1 ? 'active' : ''}">1</div>
                            <div class="step-line ${registrationStep > 1 ? 'completed' : ''}"></div>
                            <div class="step ${registrationStep >= 2 ? 'active' : ''} ${registrationStep > 2 ? 'completed' : ''}">2</div>
                            <div class="step-line ${registrationStep > 2 ? 'completed' : ''}"></div>
                            <div class="step ${registrationStep >= 3 ? 'active' : ''}">3</div>
                        </div>
                        
                        <div style="text-align: center; margin-bottom: 32px;">
                            <h3 style="font-size: ${baseSize * 1.1}px; font-weight: 600; color: #374151;">
                                ${registrationStep === 1 ? 'Ki≈üisel Bilgiler' : registrationStep === 2 ? 'Hesap Bilgileri' : 'S√∂zle≈ümeler'}
                            </h3>
                        </div>
                        ` : ''}
                        
                        ${stepContent}
                        
                        ${registrationStep < 4 ? `
                        <div style="display: flex; gap: 12px; margin-top: 32px;">
                            ${registrationStep > 1 ? `
                            <button onclick="prevStep()" class="btn" style="flex: 1; background: #E8ECF1; color: #374151;">
                                ‚Üê Geri
                            </button>
                            ` : ''}
                            <button onclick="nextStep()" class="btn btn-primary" style="flex: ${registrationStep > 1 ? '1' : '1'};">
                                ${registrationStep === 3 ? 'Hesabƒ± Olu≈ütur' : 'ƒ∞leri ‚Üí'}
                            </button>
                        </div>
                        
                        <div style="margin-top: 24px; text-align: center;">
                            <button onclick="goToLogin()" style="background: none; border: none; color: #6B7280; cursor: pointer; font-size: ${baseSize * 0.9}px; text-decoration: none; font-family: ${customFont};">
                                Zaten hesabƒ±nƒ±z var mƒ±? Giri≈ü yapƒ±n
                            </button>
                        </div>
                        ` : ''}
                    </div>
                </div>
            `;
        }

        function renderDashboard() {
            const customFont = window.elementSdk?.config?.font_family || defaultConfig.font_family;
            const baseSize = window.elementSdk?.config?.font_size || defaultConfig.font_size;
            const bgColor = window.elementSdk?.config?.background_color || defaultConfig.background_color;
            const primaryColor = window.elementSdk?.config?.primary_action_color || defaultConfig.primary_action_color;
            const secondaryColor = window.elementSdk?.config?.secondary_action_color || defaultConfig.secondary_action_color;
            
            const { active } = getUserReservations();
            const now = new Date();
            const isCheckedIn = active && now >= new Date(active.check_in);
            
            return `
                <div style="background: ${bgColor}; font-family: ${customFont}, sans-serif; font-size: ${baseSize}px; min-height: 100%; display: flex;">
                    <div class="sidebar">
                        <div style="padding: 0 32px 24px; border-bottom: 1px solid #E8ECF1;">
                            <div style="font-size: ${baseSize * 1.5}px; margin-bottom: 8px;">üë§</div>
                            <h3 style="font-size: ${baseSize * 1.1}px; font-weight: 700; margin-bottom: 4px;">${currentUser.ad} ${currentUser.soyad}</h3>
                            <p style="font-size: ${baseSize * 0.85}px; color: #6B7280;">@${currentUser.username}</p>
                        </div>
                        
                        <div style="flex: 1; padding: 24px 0;">
                            <div class="sidebar-item active" onclick="goToDashboard()">
                                <span style="font-size: 20px;">üè†</span>
                                <span>Ana Sayfa</span>
                            </div>
                            <div class="sidebar-item" onclick="currentView='current-reservation'; renderCurrentView();">
                                <span style="font-size: 20px;">üìã</span>
                                <span>Aktif Rezervasyon</span>
                            </div>
                            <div class="sidebar-item" onclick="currentView='past-reservations'; renderCurrentView();">
                                <span style="font-size: 20px;">üìú</span>
                                <span>Ge√ßmi≈ü Rezervasyonlar</span>
                            </div>
                            <div class="sidebar-item" onclick="currentView='cancel-reservation'; renderCurrentView();">
                                <span style="font-size: 20px;">‚ùå</span>
                                <span>Rezervasyon ƒ∞ptali</span>
                            </div>
                            <div class="sidebar-item" onclick="currentView='change-credentials'; renderCurrentView();">
                                <span style="font-size: 20px;">‚öôÔ∏è</span>
                                <span>Hesap Ayarlarƒ±</span>
                            </div>
                        </div>
                        
                        <div style="padding: 0 32px 24px; border-top: 1px solid #E8ECF1; padding-top: 24px;">
                            <button onclick="logout()" class="btn" style="width: 100%; background: #FEE2E2; color: #991B1B;">
                                √áƒ±kƒ±≈ü Yap
                            </button>
                        </div>
                    </div>
                    
                    <div style="flex: 1; padding: 40px; overflow-y: auto;">
                        <div class="fade-in">
                            <h1 class="poppins" style="font-size: ${baseSize * 2.2}px; font-weight: 700; margin-bottom: 8px;">
                                Ho≈ü Geldiniz! üëã
                            </h1>
                            <p style="font-size: ${baseSize * 1.05}px; color: #6B7280; margin-bottom: 40px;">
                                Size nasƒ±l yardƒ±mcƒ± olabiliriz?
                            </p>
                            
                            ${active ? `
                            <div class="card" style="padding: 32px; margin-bottom: 24px; background: linear-gradient(135deg, #EEF5FF 0%, #E8F0FE 100%); border: 2px solid ${primaryColor};">
                                <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px;">
                                    <div>
                                        <div class="badge badge-success" style="margin-bottom: 12px;">
                                            ${isCheckedIn ? '‚úì Konaklamaktasƒ±nƒ±z' : '‚è∞ Rezervasyon Aktif'}
                                        </div>
                                        <h3 style="font-size: ${baseSize * 1.3}px; font-weight: 700; margin-bottom: 8px;">Oda ${active.room_number}</h3>
                                        <p style="color: #6B7280; font-size: ${baseSize * 0.95}px;">${active.location_name}</p>
                                    </div>
                                    <div style="font-size: 64px;">üè°</div>
                                </div>
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 20px;">
                                    <div>
                                        <p style="font-size: ${baseSize * 0.85}px; color: #6B7280; margin-bottom: 4px;">Giri≈ü</p>
                                        <p style="font-weight: 600;">${new Date(active.check_in).toLocaleString('tr-TR', {day: 'numeric', month: 'short', hour: '2-digit', minute: '2-digit'})}</p>
                                    </div>
                                    <div>
                                        <p style="font-size: ${baseSize * 0.85}px; color: #6B7280; margin-bottom: 4px;">√áƒ±kƒ±≈ü</p>
                                        <p style="font-weight: 600;">${new Date(active.check_out).toLocaleString('tr-TR', {day: 'numeric', month: 'short', hour: '2-digit', minute: '2-digit'})}</p>
                                    </div>
                                </div>
                                ${isCheckedIn ? `
                                <button onclick="currentView='room-control'; renderCurrentView();" class="btn btn-primary" style="width: 100%;">
                                    üéõÔ∏è Oda Kontrol Paneli
                                </button>
                                ` : `
                                <button onclick="window.currentTicket=${JSON.stringify(active)}; currentView='ticket'; renderCurrentView();" class="btn btn-primary" style="width: 100%;">
                                    üé´ Biletimi G√∂ster
                                </button>
                                `}
                            </div>
                            ` : ''}
                            
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px;">
                                <div class="card" style="padding: 28px; cursor: pointer;" onclick="currentView='location-select'; renderCurrentView();">
                                    <div style="font-size: 48px; margin-bottom: 16px;">üîç</div>
                                    <h3 style="font-size: ${baseSize * 1.2}px; font-weight: 700; margin-bottom: 8px;">Bo≈ü Odalarƒ± Ke≈üfet</h3>
                                    <p style="color: #6B7280; font-size: ${baseSize * 0.9}px;">M√ºsait odalarƒ± g√∂r√ºnt√ºleyin ve hemen rezervasyon yapƒ±n</p>
                                </div>
                                
                                <div class="card" style="padding: 28px; cursor: pointer;" onclick="currentView='past-reservations'; renderCurrentView();">
                                    <div style="font-size: 48px; margin-bottom: 16px;">üìú</div>
                                    <h3 style="font-size: ${baseSize * 1.2}px; font-weight: 700; margin-bottom: 8px;">Ge√ßmi≈ü Rezervasyonlar</h3>
                                    <p style="color: #6B7280; font-size: ${baseSize * 0.9}px;">Tamamlanan konaklama kayƒ±tlarƒ±nƒ±zƒ± g√∂r√ºn</p>
                                </div>
                                
                                <div class="card" style="padding: 28px; cursor: pointer;" onclick="currentView='change-credentials'; renderCurrentView();">
                                    <div style="font-size: 48px; margin-bottom: 16px;">‚öôÔ∏è</div>
                                    <h3 style="font-size: ${baseSize * 1.2}px; font-weight: 700; margin-bottom: 8px;">Hesap Ayarlarƒ±</h3>
                                    <p style="color: #6B7280; font-size: ${baseSize * 0.9}px;">≈ûifre ve kullanƒ±cƒ± adƒ± deƒüi≈üikliƒüi yapƒ±n</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderLocationSelect() {
            const customFont = window.elementSdk?.config?.font_family || defaultConfig.font_family;
            const baseSize = window.elementSdk?.config?.font_size || defaultConfig.font_size;
            const bgColor = window.elementSdk?.config?.background_color || defaultConfig.background_color;
            const primaryColor = window.elementSdk?.config?.primary_action_color || defaultConfig.primary_action_color;
            
            return `
                <div style="background: ${bgColor}; font-family: ${customFont}, sans-serif; font-size: ${baseSize}px; min-height: 100%; padding: 40px;">
                    <div class="fade-in" style="max-width: 1200px; margin: 0 auto;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 40px; flex-wrap: wrap; gap: 20px;">
                            <div>
                                <h1 class="poppins" style="font-size: ${baseSize * 2.2}px; font-weight: 700; margin-bottom: 8px;">
                                    Konaklama Noktasƒ± Se√ßin
                                </h1>
                                <p style="color: #6B7280; font-size: ${baseSize * 1.05}px;">
                                    Size en uygun lokasyonu se√ßin
                                </p>
                            </div>
                            ${currentUser ? `
                            <button onclick="goToDashboard()" class="btn btn-outline">
                                ‚Üê Dashboard'a D√∂n
                            </button>
                            ` : `
                            <button onclick="goToWelcome()" class="btn btn-outline">
                                ‚Üê Ana Sayfa
                            </button>
                            `}
                        </div>
                        
                        <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 24px;">
                            ${locations.map(loc => `
                                <div class="card" onclick="selectLocation(${loc.id})" style="padding: 32px; cursor: pointer;">
                                    <div style="display: flex; align-items: center; gap: 16px; margin-bottom: 20px;">
                                        <div style="font-size: 56px;">üè†</div>
                                        <div style="flex: 1;">
                                            <h3 style="font-size: ${baseSize * 1.2}px; font-weight: 700; margin-bottom: 6px; line-height: 1.3;">${loc.name}</h3>
                                            <p style="color: #6B7280; font-size: ${baseSize * 0.9}px;">üìç ${loc.city}</p>
                                        </div>
                                    </div>
                                    <div style="background: linear-gradient(135deg, #F9FAFB 0%, #F3F4F6 100%); padding: 16px; border-radius: 12px;">
                                        <div style="display: flex; justify-content: space-between; align-items: center;">
                                            <span style="color: #6B7280; font-size: ${baseSize * 0.9}px;">Otoyol</span>
                                            <span style="font-weight: 600; color: #374151;">${loc.highway}</span>
                                        </div>
                                        <div style="height: 1px; background: #E5E7EB; margin: 12px 0;"></div>
                                        <div style="display: flex; justify-content: space-between; align-items: center;">
                                            <span style="color: #6B7280; font-size: ${baseSize * 0.9}px;">Oda Sayƒ±sƒ±</span>
                                            <span style="font-weight: 700; color: ${primaryColor}; font-size: ${baseSize * 1.2}px;">${loc.roomCount}</span>
                                        </div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `;
        }

        function renderDateSelect() {
            const customFont = window.elementSdk?.config?.font_family || defaultConfig.font_family;
            const baseSize = window.elementSdk?.config?.font_size || defaultConfig.font_size;
            const bgColor = window.elementSdk?.config?.background_color || defaultConfig.background_color;
            const primaryColor = window.elementSdk?.config?.primary_action_color || defaultConfig.primary_action_color;
            const secondaryColor = window.elementSdk?.config?.secondary_action_color || defaultConfig.secondary_action_color;
            
            return `
                <div style="background: ${bgColor}; font-family: ${customFont}, sans-serif; font-size: ${baseSize}px; min-height: 100%; display: flex; align-items: center; justify-content: center; padding: 24px;">
                    <div class="card fade-in" style="padding: 48px; max-width: 600px; width: 100%;">
                        <div class="card" style="padding: 24px; margin-bottom: 32px; background: linear-gradient(135deg, #EEF5FF 0%, #E8F0FE 100%); border: 2px solid ${primaryColor};">
                            <div style="display: flex; align-items: center; gap: 16px;">
                                <div style="font-size: 48px;">üìç</div>
                                <div>
                                    <h3 style="font-size: ${baseSize * 1.2}px; font-weight: 700; margin-bottom: 6px;">${selectedLocation.name}</h3>
                                    <p style="color: #6B7280; font-size: ${baseSize * 0.9}px;">${selectedLocation.city} ‚Ä¢ ${selectedLocation.highway}</p>
                                </div>
                            </div>
                        </div>
                        
                        <h1 class="poppins" style="font-size: ${baseSize * 2}px; font-weight: 700; margin-bottom: 8px;">
                            Tarih ve Saat Se√ßin
                        </h1>
                        <p style="color: #6B7280; font-size: ${baseSize * 1.05}px; margin-bottom: 32px;">
                            Konaklama s√ºrenizi belirleyin (maksimum 24 saat)
                        </p>
                        
                        <form onsubmit="searchAvailableRooms(event)" style="display: flex; flex-direction: column; gap: 24px;">
                            <div>
                                <label for="check-in" style="display: block; margin-bottom: 8px; font-weight: 600; font-size: ${baseSize * 0.9}px; color: #374151;">
                                    üïê Giri≈ü Tarihi ve Saati
                                </label>
                                <input type="datetime-local" id="check-in" class="input-field" required>
                            </div>
                            
                            <div>
                                <label for="check-out" style="display: block; margin-bottom: 8px; font-weight: 600; font-size: ${baseSize * 0.9}px; color: #374151;">
                                    üïê √áƒ±kƒ±≈ü Tarihi ve Saati
                                </label>
                                <input type="datetime-local" id="check-out" class="input-field" required>
                            </div>
                            
                            <div style="background: #FFF7ED; padding: 16px; border-radius: 12px; border-left: 4px solid #F59E0B;">
                                <p style="font-size: ${baseSize * 0.85}px; color: #92400E;">
                                    ‚ö†Ô∏è Maksimum kiralama s√ºresi 24 saattir. Daha uzun s√ºreler i√ßin l√ºtfen birden fazla rezervasyon yapƒ±nƒ±z.
                                </p>
                            </div>
                            
                            <button type="submit" class="btn btn-primary" style="width: 100%; padding: 16px; font-size: ${baseSize * 1.05}px;">
                                M√ºsait Odalarƒ± G√∂ster ‚Üí
                            </button>
                            
                            <button type="button" onclick="currentView='location-select'; renderCurrentView();" class="btn btn-outline" style="width: 100%;">
                                ‚Üê Geri D√∂n
                            </button>
                        </form>
                    </div>
                </div>
            `;
        }

        function renderAvailableRooms() {
            const customFont = window.elementSdk?.config?.font_family || defaultConfig.font_family;
            const baseSize = window.elementSdk?.config?.font_size || defaultConfig.font_size;
            const bgColor = window.elementSdk?.config?.background_color || defaultConfig.background_color;
            const primaryColor = window.elementSdk?.config?.primary_action_color || defaultConfig.primary_action_color;
            const secondaryColor = window.elementSdk?.config?.secondary_action_color || defaultConfig.secondary_action_color;
            
            const checkInDate = new Date(selectedDateRange.checkIn);
            const checkOutDate = new Date(selectedDateRange.checkOut);
            const hours = ((checkOutDate - checkInDate) / (1000 * 60 * 60)).toFixed(1);
            const estimatedPrice = (hours * 100).toFixed(2);
            
            const allRoomsInLocation = allRooms[selectedLocation.id];
            const occupiedRooms = allRoomsInLocation.filter(room => !availableRooms.find(r => r.id === room.id));
            
            return `
                <div style="background: ${bgColor}; font-family: ${customFont}, sans-serif; font-size: ${baseSize}px; min-height: 100%; padding: 40px;">
                    <div class="fade-in" style="max-width: 1200px; margin: 0 auto;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 40px; flex-wrap: wrap; gap: 20px;">
                            <div>
                                <h1 class="poppins" style="font-size: ${baseSize * 2.2}px; font-weight: 700; margin-bottom: 8px;">
                                    M√ºsait Odalar
                                </h1>
                                <p style="color: #6B7280; font-size: ${baseSize * 1.05}px;">
                                    ${availableRooms.length} oda m√ºsait
                                </p>
                            </div>
                            <button onclick="currentView='date-select'; renderCurrentView();" class="btn btn-outline">
                                ‚Üê Tarihleri Deƒüi≈ütir
                            </button>
                        </div>
                        
                        <div class="card" style="padding: 32px; margin-bottom: 32px;">
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 32px; margin-bottom: 24px;">
                                <div>
                                    <h3 style="font-size: ${baseSize * 1.3}px; font-weight: 700; margin-bottom: 16px;">üìç ${selectedLocation.name}</h3>
                                    <div style="display: flex; flex-direction: column; gap: 12px;">
                                        <div style="display: flex; align-items: center; gap: 8px;">
                                            <span style="color: #6B7280;">üïê Giri≈ü:</span>
                                            <span style="font-weight: 600;">${checkInDate.toLocaleString('tr-TR', {day: 'numeric', month: 'long', hour: '2-digit', minute: '2-digit'})}</span>
                                        </div>
                                        <div style="display: flex; align-items: center; gap: 8px;">
                                            <span style="color: #6B7280;">üïê √áƒ±kƒ±≈ü:</span>
                                            <span style="font-weight: 600;">${checkOutDate.toLocaleString('tr-TR', {day: 'numeric', month: 'long', hour: '2-digit', minute: '2-digit'})}</span>
                                        </div>
                                        <div style="display: flex; align-items: center; gap: 8px;">
                                            <span style="color: #6B7280;">‚è±Ô∏è S√ºre:</span>
                                            <span style="font-weight: 600;">${hours} saat</span>
                                        </div>
                                    </div>
                                </div>
                                <div style="background: linear-gradient(135deg, #EEF5FF 0%, #E8F0FE 100%); padding: 24px; border-radius: 16px; border: 2px solid ${primaryColor};">
                                    <p style="color: #6B7280; font-size: ${baseSize * 0.9}px; margin-bottom: 8px;">Tahmini Tutar</p>
                                    <p style="font-size: ${baseSize * 2.5}px; font-weight: 800; color: ${primaryColor};">${estimatedPrice} ‚Ç∫</p>
                                    <p style="color: #6B7280; font-size: ${baseSize * 0.85}px; margin-top: 8px;">100 ‚Ç∫ / saat</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="card" style="padding: 32px;">
                            <h2 style="font-size: ${baseSize * 1.5}px; font-weight: 700; margin-bottom: 24px;">Oda Durumu</h2>
                            
                            <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 16px;">
                                ${availableRooms.map(room => `
                                    <div class="room-card available" onclick="selectRoom('${room.id}')">
                                        <div class="room-icon">üè°</div>
                                        <div style="font-weight: 700; font-size: ${baseSize * 1.1}px; margin-bottom: 8px;">Oda ${room.number}</div>
                                        <div class="badge badge-success">M√ºsait</div>
                                    </div>
                                `).join('')}
                                
                                ${occupiedRooms.map(room => `
                                    <div class="room-card occupied">
                                        <div class="room-icon">üèòÔ∏è</div>
                                        <div style="font-weight: 700; font-size: ${baseSize * 1.1}px; margin-bottom: 8px;">Oda ${room.number}</div>
                                        <div class="badge badge-error">Dolu</div>
                                    </div>
                                `).join('')}
                            </div>
                            
                            <div style="margin-top: 32px; padding-top: 24px; border-top: 1px solid #E8ECF1; display: flex; gap: 16px; justify-content: center;">
                                <div style="display: flex; align-items: center; gap: 8px;">
                                    <div style="width: 16px; height: 16px; background: linear-gradient(135deg, #ffffff 0%, #f0fdf9 100%); border: 2px solid ${secondaryColor}; border-radius: 4px;"></div>
                                    <span style="font-size: ${baseSize * 0.9}px; color: #6B7280;">M√ºsait (${availableRooms.length})</span>
                                </div>
                                <div style="display: flex; align-items: center; gap: 8px;">
                                    <div style="width: 16px; height: 16px; background: linear-gradient(135deg, #ffffff 0%, #fff5f5 100%); border: 2px solid #FF4B5C; border-radius: 4px;"></div>
                                    <span style="font-size: ${baseSize * 0.9}px; color: #6B7280;">Dolu (${occupiedRooms.length})</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderReservationDetails() {
            const customFont = window.elementSdk?.config?.font_family || defaultConfig.font_family;
            const baseSize = window.elementSdk?.config?.font_size || defaultConfig.font_size;
            const bgColor = window.elementSdk?.config?.background_color || defaultConfig.background_color;
            const primaryColor = window.elementSdk?.config?.primary_action_color || defaultConfig.primary_action_color;
            
            return `
                <div style="background: ${bgColor}; font-family: ${customFont}, sans-serif; font-size: ${baseSize}px; min-height: 100%; display: flex; align-items: center; justify-content: center; padding: 24px;">
                    <div class="card fade-in" style="padding: 48px; max-width: 600px; width: 100%;">
                        <div style="text-align: center; margin-bottom: 32px;">
                            <div style="font-size: 64px; margin-bottom: 16px;">üè°</div>
                            <h1 class="poppins" style="font-size: ${baseSize * 2}px; font-weight: 700; margin-bottom: 8px;">
                                Rezervasyon Detaylarƒ±
                            </h1>
                            <p style="color: #6B7280; font-size: ${baseSize * 1.05}px;">
                                Son adƒ±ma geldiniz!
                            </p>
                        </div>
                        
                        <div class="card" style="padding: 24px; margin-bottom: 24px; background: #F9FAFB;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 12px;">
                                <span style="color: #6B7280;">Konum</span>
                                <span style="font-weight: 600;">${selectedLocation.name}</span>
                            </div>
                            <div style="display: flex; justify-content: space-between;">
                                <span style="color: #6B7280;">Oda Numarasƒ±</span>
                                <span style="font-weight: 700; color: ${primaryColor}; font-size: ${baseSize * 1.2}px;">Oda ${window.selectedRoom.number}</span>
                            </div>
                        </div>
                        
                        <form onsubmit="submitReservation(event)" style="display: flex; flex-direction: column; gap: 24px;">
                            <div>
                                <label for="guest-count" style="display: block; margin-bottom: 8px; font-weight: 600; font-size: ${baseSize * 0.9}px; color: #374151;">
                                    üë• KaÔøΩÔøΩ ki≈üi kalacaksƒ±nƒ±z?
                                </label>
                                <input type="number" id="guest-count" min="1" max="10" value="2" class="input-field" required>
                                <p style="font-size: ${baseSize * 0.85}px; color: #6B7280; margin-top: 6px;">Maksimum 10 ki≈üi</p>
                            </div>
                            
                            <button type="submit" class="btn btn-primary" style="width: 100%; padding: 16px; font-size: ${baseSize * 1.05}px;">
                                √ñdemeye Ge√ß ‚Üí
                            </button>
                            
                            <button type="button" onclick="currentView='available-rooms'; renderCurrentView();" class="btn btn-outline" style="width: 100%;">
                                ‚Üê Geri D√∂n
                            </button>
                        </form>
                    </div>
                </div>
            `;
        }

        function renderPayment() {
            const customFont = window.elementSdk?.config?.font_family || defaultConfig.font_family;
            const baseSize = window.elementSdk?.config?.font_size || defaultConfig.font_size;
            const bgColor = window.elementSdk?.config?.background_color || defaultConfig.background_color;
            const primaryColor = window.elementSdk?.config?.primary_action_color || defaultConfig.primary_action_color;
            
            return `
                <div style="background: ${bgColor}; font-family: ${customFont}, sans-serif; font-size: ${baseSize}px; min-height: 100%; display: flex; align-items: center; justify-content: center; padding: 24px;">
                    <div class="card fade-in" style="padding: 48px; max-width: 600px; width: 100%;">
                        <div style="text-align: center; margin-bottom: 32px;">
                            <div style="font-size: 64px; margin-bottom: 16px;">üí≥</div>
                            <h1 class="poppins" style="font-size: ${baseSize * 2}px; font-weight: 700; margin-bottom: 8px;">
                                √ñdeme
                            </h1>
                            <p style="color: #6B7280; font-size: ${baseSize * 1.05}px;">
                                G√ºvenli √∂deme ile rezervasyonu tamamlayƒ±n
                            </p>
                        </div>
                        
                        <div class="card" style="padding: 24px; margin-bottom: 32px; background: linear-gradient(135deg, #EEF5FF 0%, #E8F0FE 100%); border: 2px solid ${primaryColor};">
                            <h3 style="font-size: ${baseSize * 1.2}px; font-weight: 700; margin-bottom: 16px;">Rezervasyon √ñzeti</h3>
                            <div style="display: flex; flex-direction: column; gap: 10px; color: #374151;">
                                <div style="display: flex; justify-content: space-between;">
                                    <span>Konum</span>
                                    <span style="font-weight: 600;">${window.pendingReservation.location.name}</span>
                                </div>
                                <div style="display: flex; justify-content: space-between;">
                                    <span>Oda</span>
                                    <span style="font-weight: 600;">Oda ${window.pendingReservation.room.number}</span>
                                </div>
                                <div style="display: flex; justify-content: space-between;">
                                    <span>Ki≈üi Sayƒ±sƒ±</span>
                                    <span style="font-weight: 600;">${window.pendingReservation.guest_count} ki≈üi</span>
                                </div>
                                <div style="display: flex; justify-content: space-between;">
                                    <span>S√ºre</span>
                                    <span style="font-weight: 600;">${window.pendingReservation.hours} saat</span>
                                </div>
                                <div style="height: 1px; background: ${primaryColor}; margin: 8px 0;"></div>
                                <div style="display: flex; justify-content: space-between; font-size: ${baseSize * 1.3}px;">
                                    <span style="font-weight: 700;">Toplam</span>
                                    <span style="font-weight: 800; color: ${primaryColor};">${window.pendingReservation.price} ‚Ç∫</span>
                                </div>
                            </div>
                        </div>
                        
                        <form onsubmit="processPayment(event)" style="display: flex; flex-direction: column; gap: 20px;">
                            <div>
                                <label for="card-number" style="display: block; margin-bottom: 8px; font-weight: 600; font-size: ${baseSize * 0.9}px; color: #374151;">Kart Numarasƒ±</label>
                                <input type="text" id="card-number" maxlength="16" placeholder="1234 5678 9012 3456" class="input-field" required>
                            </div>
                            
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                                <div>
                                    <label for="expiry" style="display: block; margin-bottom: 8px; font-weight: 600; font-size: ${baseSize * 0.9}px; color: #374151;">Son Kullanma</label>
                                    <input type="text" id="expiry" placeholder="AA/YY" maxlength="5" class="input-field" required>
                                </div>
                                <div>
                                    <label for="cvv" style="display: block; margin-bottom: 8px; font-weight: 600; font-size: ${baseSize * 0.9}px; color: #374151;">CVV</label>
                                    <input type="text" id="cvv" maxlength="3" placeholder="123" class="input-field" required>
                                </div>
                            </div>
                            
                            <div style="background: #F0FDF4; padding: 16px; border-radius: 12px; border-left: 4px solid #10B981;">
                                <p style="font-size: ${baseSize * 0.85}px; color: #065F46;">
                                    üîí √ñdemeniz SSL ile g√ºvence altƒ±ndadƒ±r. Kart bilgileriniz saklanmaz.
                                </p>
                            </div>
                            
                            <button type="submit" class="btn btn-primary" style="width: 100%; padding: 16px; font-size: ${baseSize * 1.05}px;">
                                ${window.pendingReservation.price} ‚Ç∫ √ñde
                            </button>
                            
                            <button type="button" onclick="currentView='reservation-details'; renderCurrentView();" class="btn btn-outline" style="width: 100%;">
                                ‚Üê Geri D√∂n
                            </button>
                        </form>
                    </div>
                </div>
            `;
        }

        function renderTicket() {
            const customFont = window.elementSdk?.config?.font_family || defaultConfig.font_family;
            const baseSize = window.elementSdk?.config?.font_size || defaultConfig.font_size;
            const bgColor = window.elementSdk?.config?.background_color || defaultConfig.background_color;
            const primaryColor = window.elementSdk?.config?.primary_action_color || defaultConfig.primary_action_color;
            const secondaryColor = window.elementSdk?.config?.secondary_action_color || defaultConfig.secondary_action_color;
            
            const ticket = window.currentTicket;
            const checkIn = new Date(ticket.check_in);
            const checkOut = new Date(ticket.check_out);
            
            return `
                <div style="background: linear-gradient(135deg, ${bgColor} 0%, #E8F0FE 100%); font-family: ${customFont}, sans-serif; font-size: ${baseSize}px; min-height: 100%; display: flex; align-items: center; justify-content: center; padding: 24px;">
                    <div class="fade-in" style="max-width: 500px; width: 100%;">
                        <div style="text-align: center; margin-bottom: 32px;">
                            <div style="font-size: 80px; margin-bottom: 16px; animation: pulse 2s infinite;">üéâ</div>
                            <h1 class="poppins" style="font-size: ${baseSize * 2.5}px; font-weight: 800; margin-bottom: 8px; color: ${secondaryColor};">
                                Rezervasyon Ba≈üarƒ±lƒ±!
                            </h1>
                            <p style="color: #6B7280; font-size: ${baseSize * 1.1}px;">
                                Biletiniz hazƒ±r
                            </p>
                        </div>
                        
                        <div class="card" style="padding: 40px; margin-bottom: 20px; background: white;">
                            <div class="qr-container" style="margin: 0 auto 32px;">
                                <img id="qr-code-image" style="width: 200px; height: 200px; display: block;" alt="QR Kod">
                            </div>
                            
                            <div style="text-align: center; margin-bottom: 24px;">
                                <div class="badge badge-success" style="font-size: ${baseSize * 0.95}px; padding: 8px 16px;">
                                    Bilet No: ${ticket.ticket_number}
                                </div>
                            </div>
                            
                            <div style="background: #F9FAFB; padding: 24px; border-radius: 12px; display: flex; flex-direction: column; gap: 12px;">
                                <div style="display: flex; justify-content: space-between;">
                                    <span style="color: #6B7280;">Konum</span>
                                    <span style="font-weight: 600; text-align: right;">${ticket.location_name}</span>
                                </div>
                                <div style="display: flex; justify-content: space-between;">
                                    <span style="color: #6B7280;">Oda</span>
                                    <span style="font-weight: 700; color: ${primaryColor};">Oda ${ticket.room_number}</span>
                                </div>
                                <div style="display: flex; justify-content: space-between;">
                                    <span style="color: #6B7280;">Ki≈üi Sayƒ±sƒ±</span>
                                    <span style="font-weight: 600;">${ticket.guest_count} ki≈üi</span>
                                </div>
                                <div style="height: 1px; background: #E5E7EB; margin: 4px 0;"></div>
                                <div style="display: flex; justify-content: space-between;">
                                    <span style="color: #6B7280;">Giri≈ü</span>
                                    <span style="font-weight: 600;">${checkIn.toLocaleString('tr-TR', {day: 'numeric', month: 'short', hour: '2-digit', minute: '2-digit'})}</span>
                                </div>
                                <div style="display: flex; justify-content: space-between;">
                                    <span style="color: #6B7280;">√áƒ±kƒ±≈ü</span>
                                    <span style="font-weight: 600;">${checkOut.toLocaleString('tr-TR', {day: 'numeric', month: 'short', hour: '2-digit', minute: '2-digit'})}</span>
                                </div>
                                <div style="height: 1px; background: #E5E7EB; margin: 4px 0;"></div>
                                <div style="display: flex; justify-content: space-between; font-size: ${baseSize * 1.2}px;">
                                    <span style="font-weight: 700;">√úcret</span>
                                    <span style="font-weight: 800; color: ${secondaryColor};">${ticket.price} ‚Ç∫</span>
                                </div>
                            </div>
                        </div>
                        
                        <div style="background: #EEF5FF; padding: 20px; border-radius: 12px; text-align: center; margin-bottom: 20px;">
                            <p style="color: #1E40AF; font-size: ${baseSize * 0.95}px; line-height: 1.6;">
                                üîë QR kodu kapƒ± okuyucusuna g√∂stererek odaya girebilirsiniz
                            </p>
                        </div>
                        
                        <button onclick="currentView='room-control'; renderCurrentView();" class="btn btn-primary" style="width: 100%; padding: 18px; font-size: ${baseSize * 1.1}px;">
                            üéõÔ∏è Oda Kontrol Paneline Git
                        </button>
                        
                        ${currentUser ? `
                        <button onclick="goToDashboard()" class="btn btn-outline" style="width: 100%; margin-top: 12px;">
                            Dashboard'a D√∂n
                        </button>
                        ` : ''}
                    </div>
                </div>
            `;
        }

        function renderRoomControl() {
            const customFont = window.elementSdk?.config?.font_family || defaultConfig.font_family;
            const baseSize = window.elementSdk?.config?.font_size || defaultConfig.font_size;
            const bgColor = window.elementSdk?.config?.background_color || defaultConfig.background_color;
            const primaryColor = window.elementSdk?.config?.primary_action_color || defaultConfig.primary_action_color;
            
            return `
                <div style="background: ${bgColor}; font-family: ${customFont}, sans-serif; font-size: ${baseSize}px; min-height: 100%; padding: 40px;">
                    <div class="fade-in" style="max-width: 800px; margin: 0 auto;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 40px; flex-wrap: wrap; gap: 20px;">
                            <div>
                                <h1 class="poppins" style="font-size: ${baseSize * 2.2}px; font-weight: 700; margin-bottom: 8px;">
                                    Oda Kontrol Paneli üéõÔ∏è
                                </h1>
                                <p style="color: #6B7280; font-size: ${baseSize * 1.05}px;">
                                    Odanƒ±zƒ± istediƒüiniz gibi y√∂netin
                                </p>
                            </div>
                            ${currentUser ? `
                            <button onclick="goToDashboard()" class="btn btn-outline">
                                ‚Üê Dashboard
                            </button>
                            ` : ''}
                        </div>
                        
                        <div class="card" style="padding: 32px; margin-bottom: 20px; background: ${isBluetoothConnected ? 'linear-gradient(135deg, #D1FAE5 0%, #A7F3D0 100%)' : 'linear-gradient(135deg, #FEF3C7 0%, #FDE68A 100%)'}; border: 2px solid ${isBluetoothConnected ? secondaryColor : '#F59E0B'};">
                            <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 16px;">
                                <div style="flex: 1;">
                                    <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 8px;">
                                        <span style="font-size: 32px;">${isBluetoothConnected ? 'üì°' : 'ÔøΩÔøΩÔøΩ'}</span>
                                        <h3 style="font-size: ${baseSize * 1.4}px; font-weight: 700;">
                                            ${isBluetoothConnected ? 'Bluetooth Baƒülƒ±' : 'Bluetooth Kontrol√º'}
                                        </h3>
                                    </div>
                                    <p style="color: ${isBluetoothConnected ? '#065F46' : '#92400E'}; font-size: ${baseSize * 0.95}px;">
                                        ${isBluetoothConnected ? 'Arduino LED kontrol√º aktif' : 'Arduino ile LED kontrol√º i√ßin baƒülanƒ±n'}
                                    </p>
                                </div>
                                ${isBluetoothConnected ? `
                                <button onclick="disconnectBluetooth()" class="btn" style="background: #FEE2E2; color: #991B1B; padding: 14px 28px;">
                                    üîå Baƒülantƒ±yƒ± Kes
                                </button>
                                ` : `
                                <button onclick="connectBluetooth()" class="btn btn-primary" style="padding: 14px 28px;">
                                    üì° Bluetooth'a Baƒülan
                                </button>
                                `}
                            </div>
                        </div>
                        
                        <div style="display: grid; gap: 20px;">
                            <div class="card" style="padding: 32px;">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                                    <div style="flex: 1;">
                                        <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 8px;">
                                            <span style="font-size: 32px;">üí°</span>
                                            <h3 style="font-size: ${baseSize * 1.4}px; font-weight: 700;">LED Kontrol√º (Arduino)</h3>
                                        </div>
                                        <p style="color: #6B7280; font-size: ${baseSize * 0.95}px;">
                                            ${isBluetoothConnected ? 'Bluetooth √ºzerinden Arduino LED\'ini kontrol edin' : 'LED kontrol√º i√ßin √∂nce Bluetooth baƒülantƒ±sƒ± kurun'}
                                        </p>
                                    </div>
                                    <div id="light-toggle" class="toggle-switch ${!isBluetoothConnected ? '' : ''}" onclick="${isBluetoothConnected ? 'toggleLight()' : 'showToast(\'‚ö†Ô∏è √ñnce Bluetooth baƒülantƒ±sƒ± kurun\', \'error\')'}"></div>
                                </div>
                            </div>
                            
                            <div class="card" style="padding: 32px;">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                                    <div style="flex: 1;">
                                        <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 8px;">
                                            <span style="font-size: 32px;">‚ùÑÔ∏è</span>
                                            <h3 style="font-size: ${baseSize * 1.4}px; font-weight: 700;">Klima Kontrol√º</h3>
                                        </div>
                                        <p style="color: #6B7280; font-size: ${baseSize * 0.95}px;">Oda sƒ±caklƒ±ƒüƒ±nƒ± ayarlayƒ±n</p>
                                    </div>
                                    <div id="ac-toggle" class="toggle-switch" onclick="toggleAC()"></div>
                                </div>
                                <div id="temp-control" style="display: none; padding-top: 24px; border-top: 1px solid #E8ECF1; margin-top: 16px;">
                                    <div style="text-align: center; margin-bottom: 20px;">
                                        <div id="temp-display" style="font-size: ${baseSize * 3}px; font-weight: 800; color: ${primaryColor};">22¬∞C</div>
                                    </div>
                                    <input type="range" min="16" max="30" value="22" class="temperature-slider" oninput="updateTemp(this.value)">
                                    <div style="display: flex; justify-content: space-between; margin-top: 12px; color: #6B7280; font-size: ${baseSize * 0.85}px;">
                                        <span>16¬∞C</span>
                                        <span>30¬∞C</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="card" style="padding: 32px;">
                                <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 16px;">
                                    <span style="font-size: 32px;">üö™</span>
                                    <h3 style="font-size: ${baseSize * 1.4}px; font-weight: 700;">Kapƒ± Kontrol√º</h3>
                                </div>
                                <p style="color: #6B7280; font-size: ${baseSize * 0.95}px; margin-bottom: 24px;">
                                    QR kodunuzu okutarak kapƒ±yƒ± a√ßabilirsiniz
                                </p>
                                <button onclick="openDoor()" class="btn btn-primary" style="width: 100%; padding: 16px; font-size: ${baseSize * 1.05}px;">
                                    Kapƒ±yƒ± A√ß
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderCurrentReservation() {
            const customFont = window.elementSdk?.config?.font_family || defaultConfig.font_family;
            const baseSize = window.elementSdk?.config?.font_size || defaultConfig.font_size;
            const bgColor = window.elementSdk?.config?.background_color || defaultConfig.background_color;
            const primaryColor = window.elementSdk?.config?.primary_action_color || defaultConfig.primary_action_color;
            
            const { active } = getUserReservations();
            const now = new Date();
            const isCheckedIn = active && now >= new Date(active.check_in);
            
            let content = '';
            if (!active) {
                content = `
                    <div style="text-align: center; padding: 80px 20px;">
                        <div style="font-size: 80px; margin-bottom: 24px;">üì≠</div>
                        <h3 style="font-size: ${baseSize * 1.5}px; font-weight: 700; margin-bottom: 12px;">Aktif Rezervasyon Yok</h3>
                        <p style="color: #6B7280; font-size: ${baseSize * 1.05}px; margin-bottom: 32px;">
                            Hen√ºz aktif bir rezervasyonunuz bulunmuyor
                        </p>
                        <button onclick="currentView='location-select'; renderCurrentView();" class="btn btn-primary" style="padding: 16px 32px;">
                            Yeni Rezervasyon Yap
                        </button>
                    </div>
                `;
            } else {
                content = `
                    <div class="card" style="padding: 40px;">
                        ${isCheckedIn ? `
                        <div style="background: linear-gradient(135deg, #D1FAE5 0%, #A7F3D0 100%); padding: 20px; border-radius: 12px; margin-bottom: 32px; text-align: center; border: 2px solid #10B981;">
                            <div style="font-size: 40px; margin-bottom: 12px;">‚úÖ</div>
                            <h3 style="font-size: ${baseSize * 1.3}px; font-weight: 700; color: #065F46;">
                                ≈ûu Anda Konaklamaktasƒ±nƒ±z
                            </h3>
                        </div>
                        ` : ''}
                        
                        <div style="display: flex; align-items: center; gap: 20px; margin-bottom: 32px;">
                            <div style="font-size: 64px;">ÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩ</div>
                            <div>
                                <h2 style="font-size: ${baseSize * 1.8}px; font-weight: 700; margin-bottom: 8px;">Oda ${active.room_number}</h2>
                                <p style="color: #6B7280; font-size: ${baseSize * 1.05}px;">${active.location_name}</p>
                            </div>
                        </div>
                        
                        <div style="background: #F9FAFB; padding: 24px; border-radius: 12px; margin-bottom: 32px;">
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                                <div>
                                    <p style="color: #6B7280; font-size: ${baseSize * 0.9}px; margin-bottom: 6px;">Giri≈ü</p>
                                    <p style="font-weight: 700; font-size: ${baseSize * 1.1}px;">${new Date(active.check_in).toLocaleString('tr-TR', {day: 'numeric', month: 'long', hour: '2-digit', minute: '2-digit'})}</p>
                                </div>
                                <div>
                                    <p style="color: #6B7280; font-size: ${baseSize * 0.9}px; margin-bottom: 6px;">√áƒ±kƒ±≈ü</p>
                                    <p style="font-weight: 700; font-size: ${baseSize * 1.1}px;">${new Date(active.check_out).toLocaleString('tr-TR', {day: 'numeric', month: 'long', hour: '2-digit', minute: '2-digit'})}</p>
                                </div>
                            </div>
                            <div style="height: 1px; background: #E5E7EB; margin: 20px 0;"></div>
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <span style="color: #6B7280;">Toplam √úcret</span>
                                <span style="font-size: ${baseSize * 1.5}px; font-weight: 800; color: ${primaryColor};">${active.price} ‚Ç∫</span>
                            </div>
                        </div>
                        
                        ${isCheckedIn ? `
                        <button onclick="currentView='room-control'; renderCurrentView();" class="btn btn-primary" style="width: 100%; padding: 18px; font-size: ${baseSize * 1.1}px;">
                            üéõÔ∏è Oda Kontrol Paneli
                        </button>
                        ` : `
                        <button onclick="window.currentTicket=${JSON.stringify(active)}; currentView='ticket'; renderCurrentView();" class="btn btn-primary" style="width: 100%; padding: 18px; font-size: ${baseSize * 1.1}px;">
                            üé´ Biletimi G√∂ster
                        </button>
                        `}
                    </div>
                `;
            }
            
            return `
                <div style="background: ${bgColor}; font-family: ${customFont}, sans-serif; font-size: ${baseSize}px; min-height: 100%; display: flex;">
                    ${renderSidebar('current-reservation')}
                    <div style="flex: 1; padding: 40px; overflow-y: auto;">
                        <div class="fade-in" style="max-width: 800px; margin: 0 auto;">
                            <h1 class="poppins" style="font-size: ${baseSize * 2.2}px; font-weight: 700; margin-bottom: 40px;">
                                Aktif Rezervasyonum
                            </h1>
                            ${content}
                        </div>
                    </div>
                </div>
            `;
        }

        function renderPastReservations() {
            const customFont = window.elementSdk?.config?.font_family || defaultConfig.font_family;
            const baseSize = window.elementSdk?.config?.font_size || defaultConfig.font_size;
            const bgColor = window.elementSdk?.config?.background_color || defaultConfig.background_color;
            const secondaryColor = window.elementSdk?.config?.secondary_action_color || defaultConfig.secondary_action_color;
            
            const { past } = getUserReservations();
            
            let content = '';
            if (past.length === 0) {
                content = `
                    <div style="text-align: center; padding: 80px 20px;">
                        <div style="font-size: 80px; margin-bottom: 24px;">üì≠</div>
                        <h3 style="font-size: ${baseSize * 1.5}px; font-weight: 700; margin-bottom: 12px;">Ge√ßmi≈ü Rezervasyon Yok</h3>
                        <p style="color: #6B7280; font-size: ${baseSize * 1.05}px;">
                            Hen√ºz tamamlanmƒ±≈ü rezervasyonunuz bulunmuyor
                        </p>
                    </div>
                `;
            } else {
                content = `
                    <div style="display: grid; gap: 20px;">
                        ${past.map(res => `
                            <div class="card" style="padding: 32px;">
                                <div style="display: flex; align-items: center; gap: 16px; margin-bottom: 20px;">
                                    <div style="font-size: 48px;">üè°</div>
                                    <div>
                                        <h3 style="font-size: ${baseSize * 1.3}px; font-weight: 700; margin-bottom: 6px;">Oda ${res.room_number}</h3>
                                        <p style="color: #6B7280; font-size: ${baseSize * 0.95}px;">${res.location_name}</p>
                                    </div>
                                    <div style="margin-left: auto;">
                                        <div class="badge badge-info">Tamamlandƒ±</div>
                                    </div>
                                </div>
                                <div style="background: #F9FAFB; padding: 20px; border-radius: 12px;">
                                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                                        <div>
                                            <p style="color: #6B7280; font-size: ${baseSize * 0.85}px; margin-bottom: 4px;">Giri≈ü</p>
                                            <p style="font-weight: 600;">${new Date(res.check_in).toLocaleString('tr-TR', {day: 'numeric', month: 'short', hour: '2-digit', minute: '2-digit'})}</p>
                                        </div>
                                        <div>
                                            <p style="color: #6B7280; font-size: ${baseSize * 0.85}px; margin-bottom: 4px;">√áƒ±kƒ±≈ü</p>
                                            <p style="font-weight: 600;">${new Date(res.check_out).toLocaleString('tr-TR', {day: 'numeric', month: 'short', hour: '2-digit', minute: '2-digit'})}</p>
                                        </div>
                                    </div>
                                    <div style="height: 1px; background: #E5E7EB; margin: 16px 0;"></div>
                                    <div style="display: flex; justify-content: space-between; align-items: center;">
                                        <span style="color: #6B7280;">√úcret</span>
                                        <span style="font-weight: 700; color: ${secondaryColor}; font-size: ${baseSize * 1.2}px;">${res.price} ‚Ç∫</span>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;
            }
            
            return `
                <div style="background: ${bgColor}; font-family: ${customFont}, sans-serif; font-size: ${baseSize}px; min-height: 100%; display: flex;">
                    ${renderSidebar('past-reservations')}
                    <div style="flex: 1; padding: 40px; overflow-y: auto;">
                        <div class="fade-in" style="max-width: 800px; margin: 0 auto;">
                            <h1 class="poppins" style="font-size: ${baseSize * 2.2}px; font-weight: 700; margin-bottom: 40px;">
                                Ge√ßmi≈ü Rezervasyonlarƒ±m
                            </h1>
                            ${content}
                        </div>
                    </div>
                </div>
            `;
        }

        function renderCancelReservation() {
            const customFont = window.elementSdk?.config?.font_family || defaultConfig.font_family;
            const baseSize = window.elementSdk?.config?.font_size || defaultConfig.font_size;
            const bgColor = window.elementSdk?.config?.background_color || defaultConfig.background_color;
            
            const { active, cancelled } = getUserReservations();
            
            let cancelledContent = '';
            if (cancelled.length > 0) {
                cancelledContent = `
                    <div class="card" style="padding: 32px; margin-bottom: 32px;">
                        <h2 style="font-size: ${baseSize * 1.5}px; font-weight: 700; margin-bottom: 24px;">ƒ∞ptal Edilen Rezervasyonlar</h2>
                        <div style="display: flex; flex-direction: column; gap: 16px;">
                            ${cancelled.map(res => `
                                <div style="background: #FEF2F2; padding: 20px; border-radius: 12px; border-left: 4px solid #FF4B5C;">
                                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 12px;">
                                        <div>
                                            <h4 style="font-weight: 700; margin-bottom: 4px;">Oda ${res.room_number} - ${res.location_name}</h4>
                                            <p style="font-size: ${baseSize * 0.85}px; color: #6B7280;">ƒ∞ptal: ${new Date(res.cancelled_at).toLocaleString('tr-TR')}</p>
                                        </div>
                                        <div class="badge badge-error">ƒ∞ptal Edildi</div>
                                    </div>
                                    ${res.cancellation_reason ? `
                                    <p style="font-size: ${baseSize * 0.9}px; color: #6B7280; font-style: italic;">
                                        "${res.cancellation_reason}"
                                    </p>
                                    ` : ''}
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            }
            
            let activeContent = '';
            if (active) {
                activeContent = `
                    <div class="card" style="padding: 32px;">
                        <h2 style="font-size: ${baseSize * 1.5}px; font-weight: 700; margin-bottom: 24px;">Aktif Rezervasyonu ƒ∞ptal Et</h2>
                        
                        <div style="background: #F9FAFB; padding: 24px; border-radius: 12px; margin-bottom: 24px;">
                            <div style="display: flex; align-items: center; gap: 16px; margin-bottom: 16px;">
                                <div style="font-size: 40px;">üè°</div>
                                <div>
                                    <h3 style="font-size: ${baseSize * 1.2}px; font-weight: 700;">Oda ${active.room_number}</h3>
                                    <p style="color: #6B7280;">${active.location_name}</p>
                                </div>
                            </div>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                                <div>
                                    <p style="color: #6B7280; font-size: ${baseSize * 0.85}px;">Giri≈ü</p>
                                    <p style="font-weight: 600;">${new Date(active.check_in).toLocaleString('tr-TR', {day: 'numeric', month: 'short', hour: '2-digit', minute: '2-digit'})}</p>
                                </div>
                                <div>
                                    <p style="color: #6B7280; font-size: ${baseSize * 0.85}px;">√áƒ±kƒ±≈ü</p>
                                    <p style="font-weight: 600;">${new Date(active.check_out).toLocaleString('tr-TR', {day: 'numeric', month: 'short', hour: '2-digit', minute: '2-digit'})}</p>
                                </div>
                            </div>
                        </div>
                        
                        <div>
                            <label for="cancel-reason" style="display: block; margin-bottom: 8px; font-weight: 600; font-size: ${baseSize * 0.9}px; color: #374151;">
                                ƒ∞ptal Nedeni (ƒ∞steƒüe baƒülƒ±)
                            </label>
                            <textarea id="cancel-reason" rows="4" placeholder="ƒ∞ptal nedeninizi belirtebilirsiniz..." class="input-field" style="resize: vertical; margin-bottom: 16px;"></textarea>
                        </div>
                        
                        <div style="background: #FEF2F2; padding: 16px; border-radius: 12px; margin-bottom: 20px; border-left: 4px solid #FF4B5C;">
                            <p style="font-size: ${baseSize * 0.9}px; color: #991B1B; line-height: 1.6;">
                                ‚ö†Ô∏è Rezervasyonunuz iptal edilecek ve √∂demeniz 3-5 i≈ü g√ºn√º i√ßinde iade edilecektir.
                            </p>
                        </div>
                        
                        <button onclick="cancelReservation('${active.id}', document.getElementById('cancel-reason').value)" class="btn" style="width: 100%; background: #FF4B5C; color: white; padding: 16px; font-size: ${baseSize * 1.05}px;">
                            Rezervasyonu ƒ∞ptal Et
                        </button>
                    </div>
                `;
            } else {
                activeContent = `
                    <div class="card" style="padding: 60px; text-align: center;">
                        <div style="font-size: 64px; margin-bottom: 16px;">‚úì</div>
                        <h3 style="font-size: ${baseSize * 1.3}px; font-weight: 700; margin-bottom: 12px;">ƒ∞ptal Edilecek Rezervasyon Yok</h3>
                        <p style="color: #6B7280; font-size: ${baseSize * 1.05}px;">
                            ≈ûu anda aktif bir rezervasyonunuz bulunmuyor
                        </p>
                    </div>
                `;
            }
            
            return `
                <div style="background: ${bgColor}; font-family: ${customFont}, sans-serif; font-size: ${baseSize}px; min-height: 100%; display: flex;">
                    ${renderSidebar('cancel-reservation')}
                    <div style="flex: 1; padding: 40px; overflow-y: auto;">
                        <div class="fade-in" style="max-width: 800px; margin: 0 auto;">
                            <h1 class="poppins" style="font-size: ${baseSize * 2.2}px; font-weight: 700; margin-bottom: 40px;">
                                Rezervasyon ƒ∞ptali
                            </h1>
                            ${cancelledContent}
                            ${activeContent}
                        </div>
                    </div>
                </div>
            `;
        }

        function renderChangeCredentials() {
            const customFont = window.elementSdk?.config?.font_family || defaultConfig.font_family;
            const baseSize = window.elementSdk?.config?.font_size || defaultConfig.font_size;
            const bgColor = window.elementSdk?.config?.background_color || defaultConfig.background_color;
            const primaryColor = window.elementSdk?.config?.primary_action_color || defaultConfig.primary_action_color;
            
            return `
                <div style="background: ${bgColor}; font-family: ${customFont}, sans-serif; font-size: ${baseSize}px; min-height: 100%; display: flex;">
                    ${renderSidebar('change-credentials')}
                    <div style="flex: 1; padding: 40px; overflow-y: auto;">
                        <div class="fade-in" style="max-width: 800px; margin: 0 auto;">
                            <h1 class="poppins" style="font-size: ${baseSize * 2.2}px; font-weight: 700; margin-bottom: 40px;">
                                Hesap Ayarlarƒ±
                            </h1>
                            
                            <div class="card" style="padding: 40px; margin-bottom: 24px;">
                                <h2 style="font-size: ${baseSize * 1.5}px; font-weight: 700; margin-bottom: 24px;">≈ûifre Deƒüi≈ütir</h2>
                                <form onsubmit="event.preventDefault(); changePassword();" style="display: flex; flex-direction: column; gap: 20px;">
                                    <div>
                                        <label for="current-password" style="display: block; margin-bottom: 8px; font-weight: 600; font-size: ${baseSize * 0.9}px; color: #374151;">Mevcut ≈ûifre</label>
                                        <input type="password" id="current-password" placeholder="Mevcut ≈üifrenizi giriniz" class="input-field" required>
                                    </div>
                                    <div>
                                        <label for="new-password" style="display: block; margin-bottom: 8px; font-weight: 600; font-size: ${baseSize * 0.9}px; color: #374151;">Yeni ≈ûifre</label>
                                        <input type="password" id="new-password" placeholder="Yeni ≈üifrenizi giriniz" class="input-field" required>
                                        <p style="font-size: ${baseSize * 0.85}px; color: #6B7280; margin-top: 6px;">En az 1 harf ve 1 noktalama i≈üareti</p>
                                    </div>
                                    <div>
                                        <label for="new-password-confirm" style="display: block; margin-bottom: 8px; font-weight: 600; font-size: ${baseSize * 0.9}px; color: #374151;">Yeni ≈ûifre Tekrar</label>
                                        <input type="password" id="new-password-confirm" placeholder="Yeni ≈üifrenizi tekrar giriniz" class="input-field" required>
                                    </div>
                                    <button type="submit" class="btn btn-primary" style="padding: 14px 32px; font-size: ${baseSize * 1.05}px;">
                                        ≈ûifreyi G√ºncelle
                                    </button>
                                </form>
                            </div>
                            
                            <div class="card" style="padding: 40px;">
                                <h2 style="font-size: ${baseSize * 1.5}px; font-weight: 700; margin-bottom: 24px;">Kullanƒ±cƒ± Adƒ± Deƒüi≈ütir</h2>
                                <form onsubmit="event.preventDefault(); changeUsername();" style="display: flex; flex-direction: column; gap: 20px;">
                                    <div>
                                        <label for="current-username" style="display: block; margin-bottom: 8px; font-weight: 600; font-size: ${baseSize * 0.9}px; color: #374151;">Mevcut Kullanƒ±cƒ± Adƒ±</label>
                                        <input type="text" id="current-username" value="${currentUser.username}" disabled class="input-field" style="background: #F9FAFB; cursor: not-allowed;">
                                    </div>
                                    <div>
                                        <label for="new-username" style="display: block; margin-bottom: 8px; font-weight: 600; font-size: ${baseSize * 0.9}px; color: #374151;">Yeni Kullanƒ±cƒ± Adƒ±</label>
                                        <input type="text" id="new-username" placeholder="Yeni kullanƒ±cƒ± adƒ±nƒ±z" class="input-field" required>
                                    </div>
                                    <button type="submit" class="btn btn-primary" style="padding: 14px 32px; font-size: ${baseSize * 1.05}px;">
                                        Kullanƒ±cƒ± Adƒ±nƒ± G√ºncelle
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderSidebar(activeItem) {
            const customFont = window.elementSdk?.config?.font_family || defaultConfig.font_family;
            const baseSize = window.elementSdk?.config?.font_size || defaultConfig.font_size;
            
            return `
                <div class="sidebar">
                    <div style="padding: 0 32px 24px; border-bottom: 1px solid #E8ECF1;">
                        <div style="font-size: ${baseSize * 1.5}px; margin-bottom: 8px;">ÔøΩÔøΩÔøΩÔøΩ</div>
                        <h3 style="font-size: ${baseSize * 1.1}px; font-weight: 700; margin-bottom: 4px;">${currentUser.ad} ${currentUser.soyad}</h3>
                        <p style="font-size: ${baseSize * 0.85}px; color: #6B7280;">@${currentUser.username}</p>
                    </div>
                    
                    <div style="flex: 1; padding: 24px 0;">
                        <div class="sidebar-item ${activeItem === 'dashboard' ? 'active' : ''}" onclick="goToDashboard()">
                            <span style="font-size: 20px;">üè†</span>
                            <span>Ana Sayfa</span>
                        </div>
                        <div class="sidebar-item ${activeItem === 'current-reservation' ? 'active' : ''}" onclick="currentView='current-reservation'; renderCurrentView();">
                            <span style="font-size: 20px;">üìã</span>
                            <span>Aktif Rezervasyon</span>
                        </div>
                        <div class="sidebar-item ${activeItem === 'past-reservations' ? 'active' : ''}" onclick="currentView='past-reservations'; renderCurrentView();">
                            <span style="font-size: 20px;">üìú</span>
                            <span>Ge√ßmi≈ü Rezervasyonlar</span>
                        </div>
                        <div class="sidebar-item ${activeItem === 'cancel-reservation' ? 'active' : ''}" onclick="currentView='cancel-reservation'; renderCurrentView();">
                            <span style="font-size: 20px;">‚ùå</span>
                            <span>Rezervasyon ƒ∞ptali</span>
                        </div>
                        <div class="sidebar-item ${activeItem === 'change-credentials' ? 'active' : ''}" onclick="currentView='change-credentials'; renderCurrentView();">
                            <span style="font-size: 20px;">‚öôÔ∏è</span>
                            <span>Hesap Ayarlarƒ±</span>
                        </div>
                    </div>
                    
                    <div style="padding: 0 32px 24px; border-top: 1px solid #E8ECF1; padding-top: 24px;">
                        <button onclick="logout()" class="btn" style="width: 100%; background: #FEE2E2; color: #991B1B;">
                            √áƒ±kƒ±≈ü Yap
                        </button>
                    </div>
                </div>
            `;
        }

        function changePassword() {
            const currentPassword = document.getElementById('current-password').value;
            const newPassword = document.getElementById('new-password').value;
            const newPasswordConfirm = document.getElementById('new-password-confirm').value;
            
            if (currentPassword !== currentUser.password) {
                showToast('Mevcut ≈üifre hatalƒ±', 'error');
                return;
            }
            
            if (!validatePassword(newPassword)) {
                showToast('Yeni ≈üifre en az 1 harf ve 1 noktalama i≈üareti i√ßermelidir', 'error');
                return;
            }
            
            if (newPassword !== newPasswordConfirm) {
                showToast('Yeni ≈üifreler e≈üle≈ümiyor', 'error');
                return;
            }
            
            currentUser.password = newPassword;
            updateUser(currentUser);
            showToast('≈ûifre ba≈üarƒ±yla deƒüi≈ütirildi', 'success');
            
            document.getElementById('current-password').value = '';
            document.getElementById('new-password').value = '';
            document.getElementById('new-password-confirm').value = '';
        }

        function changeUsername() {
            const newUsername = document.getElementById('new-username').value;
            
            const users = getUsers();
            if (users.find(u => u.username === newUsername && u.id !== currentUser.id)) {
                showToast('Bu kullanƒ±cƒ± adƒ± zaten kullanƒ±lƒ±yor', 'error');
                return;
            }
            
            currentUser.username = newUsername;
            updateUser(currentUser);
            showToast('Kullanƒ±cƒ± adƒ± ba≈üarƒ±yla deƒüi≈ütirildi', 'success');
            renderCurrentView();
        }

        function generateQRCode(ticketData) {
            if (!window.QRCode) {
                showToast('QR kod k√ºt√ºphanesi y√ºkleniyor, l√ºtfen bekleyin...', 'info');
                setTimeout(() => generateQRCode(ticketData), 500);
                return;
            }
            
            const qrData = JSON.stringify({
                ticket: ticketData.ticket_number,
                room: ticketData.room_number,
                location: ticketData.location_id,
                checkIn: ticketData.check_in,
                checkOut: ticketData.check_out
            });
            
            QRCode.toDataURL(qrData, {
                errorCorrectionLevel: 'M',
                type: 'image/png',
                width: 200,
                margin: 1,
                color: {
                    dark: '#000000',
                    light: '#FFFFFF'
                }
            }).then(url => {
                const qrImage = document.getElementById('qr-code-image');
                if (qrImage) {
                    qrImage.src = url;
                }
            }).catch(err => {
                console.error('QR kod olu≈üturma hatasƒ±:', err);
                showToast('QR kod olu≈üturulamadƒ±', 'error');
            });
        }

        function renderCurrentView() {
            const app = document.getElementById('app');
            
            let html = '';
            switch(currentView) {
                case 'welcome':
                    html = renderWelcome();
                    break;
                case 'login':
                    html = renderLogin();
                    break;
                case 'register':
                    html = renderRegister();
                    break;
                case 'dashboard':
                    html = renderDashboard();
                    break;
                case 'location-select':
                    html = renderLocationSelect();
                    break;
                case 'date-select':
                    html = renderDateSelect();
                    break;
                case 'available-rooms':
                    html = renderAvailableRooms();
                    break;
                case 'reservation-details':
                    html = renderReservationDetails();
                    break;
                case 'payment':
                    html = renderPayment();
                    break;
                case 'ticket':
                    html = renderTicket();
                    break;
                case 'room-control':
                    html = renderRoomControl();
                    break;
                case 'current-reservation':
                    html = renderCurrentReservation();
                    break;
                case 'past-reservations':
                    html = renderPastReservations();
                    break;
                case 'cancel-reservation':
                    html = renderCancelReservation();
                    break;
                case 'change-credentials':
                    html = renderChangeCredentials();
                    break;
                default:
                    html = renderWelcome();
            }
            
            app.innerHTML = html;
            
            if (currentView === 'ticket' && window.currentTicket) {
                setTimeout(() => generateQRCode(window.currentTicket), 100);
            }
        }

        async function onConfigChange(config) {
            const customFont = config.font_family || defaultConfig.font_family;
            const baseSize = config.font_size || defaultConfig.font_size;
            
            document.body.style.fontFamily = `${customFont}, -apple-system, BlinkMacSystemFont, sans-serif`;
            document.body.style.fontSize = `${baseSize}px`;
            
            renderCurrentView();
        }

        function init() {
            if (window.elementSdk) {
                window.elementSdk.init({
                    defaultConfig,
                    onConfigChange,
                    mapToCapabilities: (config) => ({
                        recolorables: [
                            {
                                get: () => config.background_color || defaultConfig.background_color,
                                set: (value) => {
                                    config.background_color = value;
                                    window.elementSdk.setConfig({ background_color: value });
                                }
                            },
                            {
                                get: () => config.surface_color || defaultConfig.surface_color,
                                set: (value) => {
                                    config.surface_color = value;
                                    window.elementSdk.setConfig({ surface_color: value });
                                }
                            },
                            {
                                get: () => config.text_color || defaultConfig.text_color,
                                set: (value) => {
                                    config.text_color = value;
                                    window.elementSdk.setConfig({ text_color: value });
                                }
                            },
                            {
                                get: () => config.primary_action_color || defaultConfig.primary_action_color,
                                set: (value) => {
                                    config.primary_action_color = value;
                                    window.elementSdk.setConfig({ primary_action_color: value });
                                }
                            },
                            {
                                get: () => config.secondary_action_color || defaultConfig.secondary_action_color,
                                set: (value) => {
                                    config.secondary_action_color = value;
                                    window.elementSdk.setConfig({ secondary_action_color: value });
                                }
                            }
                        ],
                        borderables: [],
                        fontEditable: {
                            get: () => config.font_family || defaultConfig.font_family,
                            set: (value) => {
                                config.font_family = value;
                                window.elementSdk.setConfig({ font_family: value });
                            }
                        },
                        fontSizeable: {
                            get: () => config.font_size || defaultConfig.font_size,
                            set: (value) => {
                                config.font_size = value;
                                window.elementSdk.setConfig({ font_size: value });
                            }
                        }
                    }),
                    mapToEditPanelValues: (config) => new Map([
                        ['app_title', config.app_title || defaultConfig.app_title],
                        ['welcome_message', config.welcome_message || defaultConfig.welcome_message],
                        ['support_phone', config.support_phone || defaultConfig.support_phone],
                        ['support_email', config.support_email || defaultConfig.support_email]
                    ])
                });
            }
            
            renderCurrentView();
        }

        init();
    </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9ace95a0f4ecda12',t:'MTc2NTU1Njc5Ny4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
